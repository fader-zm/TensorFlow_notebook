
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>CTR预估数据准备 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="04_逻辑回归实现CTR预估.html" />
    
    
    <link rel="prev" href="02_根据用户行为数据创建ALS模型并召回商品.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    推荐系统项目实战
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../推荐系统/README.md">
            
                <span>
            
                    
                    推荐介绍
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../推荐介绍/01_推荐系统简介.html">
            
                <a href="../推荐介绍/01_推荐系统简介.html">
            
                    
                    推荐系统简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../推荐介绍/02_推荐系统架构设计.html">
            
                <a href="../推荐介绍/02_推荐系统架构设计.html">
            
                    
                    推荐系统架构设计
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../推荐介绍/03_推荐算法.html">
            
                <a href="../推荐介绍/03_推荐算法.html">
            
                    
                    推荐算法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../推荐介绍/04_ 推荐系统评估.html">
            
                <a href="../推荐介绍/04_ 推荐系统评估.html">
            
                    
                    推荐系统评估
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../推荐介绍/05_ 推荐系统冷启动问题.html">
            
                <a href="../推荐介绍/05_ 推荐系统冷启动问题.html">
            
                    
                    推荐系统冷启动问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../推荐介绍/06.0_ 案例--基于协同过滤的电影推荐.html">
            
                <a href="../推荐介绍/06.0_ 案例--基于协同过滤的电影推荐.html">
            
                    
                    基于电影的协同过滤推荐
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../推荐介绍/06.1_算法实现：User-Based CF 预测评分.html">
            
                <a href="../推荐介绍/06.1_算法实现：User-Based CF 预测评分.html">
            
                    
                    算法实现-User-Based CF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../推荐介绍/06.2_算法实现：Item-Based CF 预测评分.html">
            
                <a href="../推荐介绍/06.2_算法实现：Item-Based CF 预测评分.html">
            
                    
                    算法实现-Item-Based CF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../hadoop优化/README.md">
            
                <span>
            
                    
                    Hadoop
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../hadoop优化/ha1.0.html">
            
                <a href="../hadoop优化/ha1.0.html">
            
                    
                    第一部分 Hadoop概述
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../hadoop优化/ha1.1.html">
            
                <a href="../hadoop优化/ha1.1.html">
            
                    
                    hadoop简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../hadoop优化/ha1.2.html">
            
                <a href="../hadoop优化/ha1.2.html">
            
                    
                    hadoop核心组件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="../hadoop优化/ha1.3.html">
            
                <a href="../hadoop优化/ha1.3.html">
            
                    
                    hadoop优势
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../hadoop优化/ha2.0.html">
            
                <a href="../hadoop优化/ha2.0.html">
            
                    
                    第二部分 分布式文件系统HDFS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../hadoop优化/ha2.1.html">
            
                <a href="../hadoop优化/ha2.1.html">
            
                    
                    HDFS的使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="../hadoop优化/ha2.2.html">
            
                <a href="../hadoop优化/ha2.2.html">
            
                    
                    HDFS的Shell操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="../hadoop优化/ha2.3.html">
            
                <a href="../hadoop优化/ha2.3.html">
            
                    
                    HDFS的设计思路
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4" data-path="../hadoop优化/ha2.4.html">
            
                <a href="../hadoop优化/ha2.4.html">
            
                    
                    HDFS的架构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.5" data-path="../hadoop优化/ha2.5.html">
            
                <a href="../hadoop优化/ha2.5.html">
            
                    
                    HDFS环境搭建
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../hadoop优化/ha3.0.html">
            
                <a href="../hadoop优化/ha3.0.html">
            
                    
                    第三部分 YARN和MapReduce
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="../hadoop优化/ha3.1.html">
            
                <a href="../hadoop优化/ha3.1.html">
            
                    
                    资源调度框架YARN
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="../hadoop优化/ha3.2.html">
            
                <a href="../hadoop优化/ha3.2.html">
            
                    
                    MapReduce简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.3" data-path="../hadoop优化/ha3.3.html">
            
                <a href="../hadoop优化/ha3.3.html">
            
                    
                    MapReduce实战（MR_JOB）
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.4" data-path="../hadoop优化/ha3.4.html">
            
                <a href="../hadoop优化/ha3.4.html">
            
                    
                    MapReduce实战_文件合并
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.5" data-path="../hadoop优化/ha3.5.html">
            
                <a href="../hadoop优化/ha3.5.html">
            
                    
                    MapReduce原理
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../hadoop优化/ha4.0.html">
            
                <a href="../hadoop优化/ha4.0.html">
            
                    
                    第四部分 Hadoop概念扩展
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="../hadoop优化/ha4.1.html">
            
                <a href="../hadoop优化/ha4.1.html">
            
                    
                    hadoop生态
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.2" data-path="../hadoop优化/ha4.2.html">
            
                <a href="../hadoop优化/ha4.2.html">
            
                    
                    HDFS读写流程和高可用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.3" data-path="../hadoop优化/ha4.3.html">
            
                <a href="../hadoop优化/ha4.3.html">
            
                    
                    hadoop发行版的选择
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../spark_core/README.md">
            
                <span>
            
                    
                    Spark Core
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../spark_core/spark_core_1.html">
            
                <a href="../spark_core/spark_core_1.html">
            
                    
                    spark入门
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../spark_core/spark_core_2.html">
            
                <a href="../spark_core/spark_core_2.html">
            
                    
                    spark-core概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../spark_core/spark_core_3.html">
            
                <a href="../spark_core/spark_core_3.html">
            
                    
                    RDD常用算子练习
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../spark_core/spark_core_4.html">
            
                <a href="../spark_core/spark_core_4.html">
            
                    
                    spark-core实战1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../spark_core/spark_core_5.html">
            
                <a href="../spark_core/spark_core_5.html">
            
                    
                    spark-core实战2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../spark_core/spark_core_6.html">
            
                <a href="../spark_core/spark_core_6.html">
            
                    
                    spark相关概念补充
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../spark_sql/s1.0.html">
            
                <a href="../spark_sql/s1.0.html">
            
                    
                    Spark SQL
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../spark_sql/s1.1.html">
            
                <a href="../spark_sql/s1.1.html">
            
                    
                    spark sql概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../spark_sql/s1.2.html">
            
                <a href="../spark_sql/s1.2.html">
            
                    
                    DataFrame
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../spark_sql/s1.3.html">
            
                <a href="../spark_sql/s1.3.html">
            
                    
                    JSON数据的处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../spark_sql/s1.4.html">
            
                <a href="../spark_sql/s1.4.html">
            
                    
                    物联网项目实战
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../spark_sql/s1.5.html">
            
                <a href="../spark_sql/s1.5.html">
            
                    
                    数据清洗
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="README.md">
            
                <span>
            
                    
                    推荐系统实战1
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="01_个性化电商广告推荐系统介绍.html">
            
                <a href="01_个性化电商广告推荐系统介绍.html">
            
                    
                    电商广告推荐系统介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="02_根据用户行为数据创建ALS模型并召回商品.html">
            
                <a href="02_根据用户行为数据创建ALS模型并召回商品.html">
            
                    
                    商品召回
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6.3" data-path="03_CTR预估数据准备.html">
            
                <a href="03_CTR预估数据准备.html">
            
                    
                    CTR预估数据准备
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="04_逻辑回归实现CTR预估.html">
            
                <a href="04_逻辑回归实现CTR预估.html">
            
                    
                    逻辑回归实现CTR预估
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="05_离线推荐处理.html">
            
                <a href="05_离线推荐处理.html">
            
                    
                    离线推荐缓存处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="06_实时推荐.html">
            
                <a href="06_实时推荐.html">
            
                    
                    推荐业务完成
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../hive/README.md">
            
                <span>
            
                    
                    hive
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../hive/hive1.html">
            
                <a href="../hive/hive1.html">
            
                    
                    Hive概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../hive/hive2.html">
            
                <a href="../hive/hive2.html">
            
                    
                    Hive 安装部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../hive/hive3.html">
            
                <a href="../hive/hive3.html">
            
                    
                    Hive 基本操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../hive/hive4.html">
            
                <a href="../hive/hive4.html">
            
                    
                    Hive的内部表和外部表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../hive/hive5.html">
            
                <a href="../hive/hive5.html">
            
                    
                    分区表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../hive/hive6.html">
            
                <a href="../hive/hive6.html">
            
                    
                    Hive 函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../hive/hive7.html">
            
                <a href="../hive/hive7.html">
            
                    
                    hive综合案例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8" data-path="../hive/hive8.html">
            
                <a href="../hive/hive8.html">
            
                    
                    Sqoop
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../推荐系统实战2/chapter0.md">
            
                <span>
            
                    
                    推荐系统实战2
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../推荐系统实战2/chapter1.html">
            
                <a href="../推荐系统实战2/chapter1.html">
            
                    
                    美多商城推荐系统介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../推荐系统实战2/chapter2.html">
            
                <a href="../推荐系统实战2/chapter2.html">
            
                    
                    美多业务数据导入
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../推荐系统实战2/chapter3.html">
            
                <a href="../推荐系统实战2/chapter3.html">
            
                    
                    商品数据处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../推荐系统实战2/chapter4.html">
            
                <a href="../推荐系统实战2/chapter4.html">
            
                    
                    商品关键词提取
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../推荐系统实战2/chapter5.html">
            
                <a href="../推荐系统实战2/chapter5.html">
            
                    
                    商品关键词权重选择
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../推荐系统实战2/chapter6.html">
            
                <a href="../推荐系统实战2/chapter6.html">
            
                    
                    商品关键词词向量计算
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="../推荐系统实战2/chapter7.html">
            
                <a href="../推荐系统实战2/chapter7.html">
            
                    
                    商品相似度计算与商品召回
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.8" data-path="../推荐系统实战2/chapter8.html">
            
                <a href="../推荐系统实战2/chapter8.html">
            
                    
                    埋点日志处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.9" data-path="../推荐系统实战2/chapter9.html">
            
                <a href="../推荐系统实战2/chapter9.html">
            
                    
                    Spark Streaming
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.10" data-path="../推荐系统实战2/chapter10.html">
            
                <a href="../推荐系统实战2/chapter10.html">
            
                    
                    实时推荐
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.11" data-path="../推荐系统实战2/chapter11.html">
            
                <a href="../推荐系统实战2/chapter11.html">
            
                    
                    美多项目埋点
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >CTR预估数据准备</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="&#x516B;-ctr&#x9884;&#x4F30;&#x6570;&#x636E;&#x51C6;&#x5907;">&#x516B; CTR&#x9884;&#x4F30;&#x6570;&#x636E;&#x51C6;&#x5907;</h2>
<h3 id="81-&#x5206;&#x6790;&#x5E76;&#x9884;&#x5904;&#x7406;rawsample&#x6570;&#x636E;&#x96C6;">8.1 &#x5206;&#x6790;&#x5E76;&#x9884;&#x5904;&#x7406;raw_sample&#x6570;&#x636E;&#x96C6;</h3>
<pre><code class="lang-python"><span class="hljs-comment"># &#x4ECE;HDFS&#x4E2D;&#x52A0;&#x8F7D;&#x6837;&#x672C;&#x6570;&#x636E;&#x4FE1;&#x606F;</span>
df = spark.read.csv(<span class="hljs-string">&quot;hdfs://localhost:9000/datasets/raw_sample.csv&quot;</span>, header=<span class="hljs-keyword">True</span>)
df.show()    <span class="hljs-comment"># &#x5C55;&#x793A;&#x6570;&#x636E;&#xFF0C;&#x9ED8;&#x8BA4;&#x524D;20&#x6761;</span>
df.printSchema()
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code class="lang-shell">+------+----------+----------+-----------+------+---+
|  user|time_stamp|adgroup_id|        pid|nonclk|clk|
+------+----------+----------+-----------+------+---+
|581738|1494137644|         1|430548_1007|     1|  0|
|449818|1494638778|         3|430548_1007|     1|  0|
|914836|1494650879|         4|430548_1007|     1|  0|
|914836|1494651029|         5|430548_1007|     1|  0|
|399907|1494302958|         8|430548_1007|     1|  0|
|628137|1494524935|         9|430548_1007|     1|  0|
|298139|1494462593|         9|430539_1007|     1|  0|
|775475|1494561036|         9|430548_1007|     1|  0|
|555266|1494307136|        11|430539_1007|     1|  0|
|117840|1494036743|        11|430548_1007|     1|  0|
|739815|1494115387|        11|430539_1007|     1|  0|
|623911|1494625301|        11|430548_1007|     1|  0|
|623911|1494451608|        11|430548_1007|     1|  0|
|421590|1494034144|        11|430548_1007|     1|  0|
|976358|1494156949|        13|430548_1007|     1|  0|
|286630|1494218579|        13|430539_1007|     1|  0|
|286630|1494289247|        13|430539_1007|     1|  0|
|771431|1494153867|        13|430548_1007|     1|  0|
|707120|1494220810|        13|430548_1007|     1|  0|
|530454|1494293746|        13|430548_1007|     1|  0|
+------+----------+----------+-----------+------+---+
only showing top 20 rows

root
 |-- user: string (nullable = true)
 |-- time_stamp: string (nullable = true)
 |-- adgroup_id: string (nullable = true)
 |-- pid: string (nullable = true)
 |-- nonclk: string (nullable = true)
 |-- clk: string (nullable = true)
</code></pre>
<ul>
<li>&#x5206;&#x6790;&#x6570;&#x636E;&#x96C6;&#x5B57;&#x6BB5;&#x7684;&#x7C7B;&#x578B;&#x548C;&#x683C;&#x5F0F;<ul>
<li>&#x67E5;&#x770B;&#x662F;&#x5426;&#x6709;&#x7A7A;&#x503C;</li>
<li>&#x67E5;&#x770B;&#x6BCF;&#x5217;&#x6570;&#x636E;&#x7684;&#x7C7B;&#x578B;</li>
<li>&#x67E5;&#x770B;&#x6BCF;&#x5217;&#x6570;&#x636E;&#x7684;&#x7C7B;&#x522B;&#x60C5;&#x51B5;</li>
</ul>
</li>
</ul>
<pre><code class="lang-python">print(<span class="hljs-string">&quot;&#x6837;&#x672C;&#x6570;&#x636E;&#x96C6;&#x603B;&#x6761;&#x76EE;&#x6570;&#xFF1A;&quot;</span>, df.count())
<span class="hljs-comment"># &#x7EA6;2600w</span>
print(<span class="hljs-string">&quot;&#x7528;&#x6237;user&#x603B;&#x6570;&#xFF1A;&quot;</span>, df.groupBy(<span class="hljs-string">&quot;user&quot;</span>).count().count())
<span class="hljs-comment"># &#x7EA6; 114w&#xFF0C;&#x7565;&#x591A;&#x4F59;&#x65E5;&#x5FD7;&#x6570;&#x636E;&#x4E2D;&#x7528;&#x6237;&#x6570;</span>
print(<span class="hljs-string">&quot;&#x5E7F;&#x544A;id adgroup_id&#x603B;&#x6570;&#xFF1A;&quot;</span>, df.groupBy(<span class="hljs-string">&quot;adgroup_id&quot;</span>).count().count())
<span class="hljs-comment"># &#x7EA6;85w</span>
print(<span class="hljs-string">&quot;&#x5E7F;&#x544A;&#x5C55;&#x793A;&#x4F4D;pid&#x60C5;&#x51B5;&#xFF1A;&quot;</span>, df.groupBy(<span class="hljs-string">&quot;pid&quot;</span>).count().collect())
<span class="hljs-comment"># &#x53EA;&#x6709;&#x4E24;&#x79CD;&#x5E7F;&#x544A;&#x5C55;&#x793A;&#x4F4D;&#xFF0C;&#x5360;&#x6BD4;&#x7EA6;&#x4E3A;&#x516D;&#x6BD4;&#x56DB;</span>
print(<span class="hljs-string">&quot;&#x5E7F;&#x544A;&#x70B9;&#x51FB;&#x6570;&#x636E;&#x60C5;&#x51B5;clk&#xFF1A;&quot;</span>, df.groupBy(<span class="hljs-string">&quot;clk&quot;</span>).count().collect())
<span class="hljs-comment"># &#x70B9;&#x548C;&#x4E0D;&#x70B9;&#x6BD4;&#x7387;&#x7EA6;&#xFF1A; 1:20</span>
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code class="lang-shell">&#x6837;&#x672C;&#x6570;&#x636E;&#x96C6;&#x603B;&#x6761;&#x76EE;&#x6570;&#xFF1A; 26557961
&#x7528;&#x6237;user&#x603B;&#x6570;&#xFF1A; 1141729
&#x5E7F;&#x544A;id adgroup_id&#x603B;&#x6570;&#xFF1A; 846811
&#x5E7F;&#x544A;&#x5C55;&#x793A;&#x4F4D;pid&#x60C5;&#x51B5;&#xFF1A; [Row(pid=&apos;430548_1007&apos;, count=16472898), Row(pid=&apos;430539_1007&apos;, count=10085063)]
&#x5E7F;&#x544A;&#x70B9;&#x51FB;&#x6570;&#x636E;&#x60C5;&#x51B5;clk&#xFF1A; [Row(clk=&apos;0&apos;, count=25191905), Row(clk=&apos;1&apos;, count=1366056)]
</code></pre>
<ul>
<li>&#x4F7F;&#x7528;dataframe.withColumn&#x66F4;&#x6539;df&#x5217;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF1B;&#x4F7F;&#x7528;dataframe.withColumnRenamed&#x66F4;&#x6539;&#x5217;&#x540D;&#x79F0;</li>
</ul>
<pre><code class="lang-python"><span class="hljs-comment"># &#x66F4;&#x6539;&#x8868;&#x7ED3;&#x6784;&#xFF0C;&#x8F6C;&#x6362;&#x4E3A;&#x5BF9;&#x5E94;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;</span>
<span class="hljs-keyword">from</span> pyspark.sql.types <span class="hljs-keyword">import</span> StructType, StructField, IntegerType, FloatType, LongType, StringType

<span class="hljs-comment"># &#x6253;&#x5370;df&#x7ED3;&#x6784;&#x4FE1;&#x606F;</span>
df.printSchema()   
<span class="hljs-comment"># &#x66F4;&#x6539;df&#x8868;&#x7ED3;&#x6784;&#xFF1A;&#x66F4;&#x6539;&#x5217;&#x7C7B;&#x578B;&#x548C;&#x5217;&#x540D;&#x79F0;</span>
raw_sample_df = df.\
    withColumn(<span class="hljs-string">&quot;user&quot;</span>, df.user.cast(IntegerType())).withColumnRenamed(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;userId&quot;</span>).\
    withColumn(<span class="hljs-string">&quot;time_stamp&quot;</span>, df.time_stamp.cast(LongType())).withColumnRenamed(<span class="hljs-string">&quot;time_stamp&quot;</span>, <span class="hljs-string">&quot;timestamp&quot;</span>).\
    withColumn(<span class="hljs-string">&quot;adgroup_id&quot;</span>, df.adgroup_id.cast(IntegerType())).withColumnRenamed(<span class="hljs-string">&quot;adgroup_id&quot;</span>, <span class="hljs-string">&quot;adgroupId&quot;</span>).\
    withColumn(<span class="hljs-string">&quot;pid&quot;</span>, df.pid.cast(StringType())).\
    withColumn(<span class="hljs-string">&quot;nonclk&quot;</span>, df.nonclk.cast(IntegerType())).\
    withColumn(<span class="hljs-string">&quot;clk&quot;</span>, df.clk.cast(IntegerType()))
raw_sample_df.printSchema()
raw_sample_df.show()
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code class="lang-shell">root
 |-- user: string (nullable = true)
 |-- time_stamp: string (nullable = true)
 |-- adgroup_id: string (nullable = true)
 |-- pid: string (nullable = true)
 |-- nonclk: string (nullable = true)
 |-- clk: string (nullable = true)

root
 |-- userId: integer (nullable = true)
 |-- timestamp: long (nullable = true)
 |-- adgroupId: integer (nullable = true)
 |-- pid: string (nullable = true)
 |-- nonclk: integer (nullable = true)
 |-- clk: integer (nullable = true)

+------+----------+---------+-----------+------+---+
|userId| timestamp|adgroupId|        pid|nonclk|clk|
+------+----------+---------+-----------+------+---+
|581738|1494137644|        1|430548_1007|     1|  0|
|449818|1494638778|        3|430548_1007|     1|  0|
|914836|1494650879|        4|430548_1007|     1|  0|
|914836|1494651029|        5|430548_1007|     1|  0|
|399907|1494302958|        8|430548_1007|     1|  0|
|628137|1494524935|        9|430548_1007|     1|  0|
|298139|1494462593|        9|430539_1007|     1|  0|
|775475|1494561036|        9|430548_1007|     1|  0|
|555266|1494307136|       11|430539_1007|     1|  0|
|117840|1494036743|       11|430548_1007|     1|  0|
|739815|1494115387|       11|430539_1007|     1|  0|
|623911|1494625301|       11|430548_1007|     1|  0|
|623911|1494451608|       11|430548_1007|     1|  0|
|421590|1494034144|       11|430548_1007|     1|  0|
|976358|1494156949|       13|430548_1007|     1|  0|
|286630|1494218579|       13|430539_1007|     1|  0|
|286630|1494289247|       13|430539_1007|     1|  0|
|771431|1494153867|       13|430548_1007|     1|  0|
|707120|1494220810|       13|430548_1007|     1|  0|
|530454|1494293746|       13|430548_1007|     1|  0|
+------+----------+---------+-----------+------+---+
only showing top 20 rows
</code></pre>
<ul>
<li><p>&#x7279;&#x5F81;&#x9009;&#x53D6;&#xFF08;Feature Selection&#xFF09;</p>
<ul>
<li><p>&#x7279;&#x5F81;&#x9009;&#x62E9;&#x5C31;&#x662F;&#x9009;&#x62E9;&#x90A3;&#x4E9B;&#x9760;&#x8C31;&#x7684;Feature&#xFF0C;&#x53BB;&#x6389;&#x5197;&#x4F59;&#x7684;Feature&#xFF0C;&#x5BF9;&#x4E8E;&#x641C;&#x7D22;&#x5E7F;&#x544A;&#xFF0C;Query&#x5173;&#x952E;&#x8BCD;&#x548C;&#x5E7F;&#x544A;&#x7684;&#x5339;&#x914D;&#x7A0B;&#x5EA6;&#x5F88;&#x91CD;&#x8981;&#xFF1B;&#x4F46;&#x5BF9;&#x4E8E;&#x5C55;&#x793A;&#x5E7F;&#x544A;&#xFF0C;&#x5E7F;&#x544A;&#x672C;&#x8EAB;&#x7684;&#x5386;&#x53F2;&#x8868;&#x73B0;&#xFF0C;&#x5F80;&#x5F80;&#x662F;&#x6700;&#x91CD;&#x8981;&#x7684;Feature&#x3002;</p>
<p>&#x6839;&#x636E;&#x7ECF;&#x9A8C;&#xFF0C;&#x8BE5;&#x6570;&#x636E;&#x96C6;&#x4E2D;&#xFF0C;&#x53EA;&#x6709;&#x5E7F;&#x544A;&#x5C55;&#x793A;&#x4F4D;pid&#x5BF9;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#xFF0C;&#x4E14;&#x6570;&#x636E;&#x4E0D;&#x540C;&#x6570;&#x636E;&#x4E4B;&#x95F4;&#x7684;&#x5360;&#x6BD4;&#x7EA6;&#x4E3A;6:4&#xFF0C;&#x56E0;&#x6B64;pid&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5173;&#x952E;&#x7279;&#x5F81;</p>
<p>nonclk&#x548C;clk&#x5728;&#x8FD9;&#x91CC;&#x662F;&#x4F5C;&#x4E3A;&#x76EE;&#x6807;&#x503C;&#xFF0C;&#x4E0D;&#x505A;&#x4E3A;&#x7279;&#x5F81;</p>
</li>
</ul>
</li>
<li><p>&#x70ED;&#x72EC;&#x7F16;&#x7801; OneHotEncode</p>
<ul>
<li><p>&#x70ED;&#x72EC;&#x7F16;&#x7801;&#x662F;&#x4E00;&#x79CD;&#x7ECF;&#x5178;&#x7F16;&#x7801;&#xFF0C;&#x662F;&#x4F7F;&#x7528;N&#x4F4D;&#x72B6;&#x6001;&#x5BC4;&#x5B58;&#x5668;(&#x5982;0&#x548C;1)&#x6765;&#x5BF9;N&#x4E2A;&#x72B6;&#x6001;&#x8FDB;&#x884C;&#x7F16;&#x7801;&#xFF0C;&#x6BCF;&#x4E2A;&#x72B6;&#x6001;&#x90FD;&#x7531;&#x4ED6;&#x72EC;&#x7ACB;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x4F4D;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x4EFB;&#x610F;&#x65F6;&#x5019;&#xFF0C;&#x5176;&#x4E2D;&#x53EA;&#x6709;&#x4E00;&#x4F4D;&#x6709;&#x6548;&#x3002;</p>
<p>&#x5047;&#x8BBE;&#x6709;&#x4E09;&#x7EC4;&#x7279;&#x5F81;&#xFF0C;&#x5206;&#x522B;&#x8868;&#x793A;&#x5E74;&#x9F84;&#xFF0C;&#x57CE;&#x5E02;&#xFF0C;&#x8BBE;&#x5907;&#xFF1B;</p>
<p>[&quot;&#x7537;&quot;, &quot;&#x5973;&quot;][0,1]</p>
<p>[&quot;&#x5317;&#x4EAC;&quot;, &quot;&#x4E0A;&#x6D77;&quot;, &quot;&#x5E7F;&#x5DDE;&quot;][0,1,2]</p>
<p>[&quot;&#x82F9;&#x679C;&quot;, &quot;&#x5C0F;&#x7C73;&quot;, &quot;&#x534E;&#x4E3A;&quot;, &quot;&#x5FAE;&#x8F6F;&quot;][0,1,2,3]</p>
<p>&#x4F20;&#x7EDF;&#x53D8;&#x5316;&#xFF1A; &#x5BF9;&#x6BCF;&#x4E00;&#x7EC4;&#x7279;&#x5F81;&#xFF0C;&#x4F7F;&#x7528;&#x679A;&#x4E3E;&#x7C7B;&#x578B;&#xFF0C;&#x4ECE;0&#x5F00;&#x59CB;&#xFF1B;</p>
<p>[&quot;&#x7537;&#x201C;&#xFF0C;&#x201D;&#x4E0A;&#x6D77;&#x201C;&#xFF0C;&#x201D;&#x5C0F;&#x7C73;&#x201C;]=[ 0,1,1]</p>
<p>[&quot;&#x5973;&#x201C;&#xFF0C;&#x201D;&#x5317;&#x4EAC;&#x201C;&#xFF0C;&#x201D;&#x82F9;&#x679C;&#x201C;] =[1,0,0]</p>
<p>&#x4F20;&#x7EDF;&#x53D8;&#x5316;&#x540E;&#x7684;&#x6570;&#x636E;&#x4E0D;&#x662F;&#x8FDE;&#x7EED;&#x7684;&#xFF0C;&#x800C;&#x662F;&#x968F;&#x673A;&#x5206;&#x914D;&#x7684;&#xFF0C;&#x4E0D;&#x5BB9;&#x6613;&#x5E94;&#x7528;&#x5728;&#x5206;&#x7C7B;&#x5668;&#x4E2D;</p>
<p>&#x800C;&#x7ECF;&#x8FC7;&#x70ED;&#x72EC;&#x7F16;&#x7801;&#xFF0C;&#x6570;&#x636E;&#x4F1A;&#x53D8;&#x6210;&#x7A00;&#x758F;&#x7684;&#xFF0C;&#x65B9;&#x4FBF;&#x5206;&#x7C7B;&#x5668;&#x5904;&#x7406;&#xFF1A;</p>
<p>[&quot;&#x7537;&#x201C;&#xFF0C;&#x201D;&#x4E0A;&#x6D77;&#x201C;&#xFF0C;&#x201D;&#x5C0F;&#x7C73;&#x201C;]=[ 1,0,0,1,0,0,1,0,0]</p>
<p>[&quot;&#x5973;&#x201C;&#xFF0C;&#x201D;&#x5317;&#x4EAC;&#x201C;&#xFF0C;&#x201D;&#x82F9;&#x679C;&#x201C;] =[0,1,1,0,0,1,0,0,0]</p>
<p>&#x8FD9;&#x6837;&#x505A;&#x4FDD;&#x7559;&#x4E86;&#x7279;&#x5F81;&#x7684;&#x591A;&#x6837;&#x6027;&#xFF0C;&#x4F46;&#x662F;&#x4E5F;&#x8981;&#x6CE8;&#x610F;&#x5982;&#x679C;&#x6570;&#x636E;&#x8FC7;&#x4E8E;&#x7A00;&#x758F;(&#x6837;&#x672C;&#x8F83;&#x5C11;&#x3001;&#x7EF4;&#x5EA6;&#x8FC7;&#x9AD8;)&#xFF0C;&#x5176;&#x6548;&#x679C;&#x53CD;&#x800C;&#x4F1A;&#x53D8;&#x5DEE;</p>
</li>
</ul>
</li>
<li><p>Spark&#x4E2D;&#x4F7F;&#x7528;&#x70ED;&#x72EC;&#x7F16;&#x7801;</p>
<ul>
<li><p>&#x6CE8;&#x610F;&#xFF1A;&#x70ED;&#x7F16;&#x7801;&#x53EA;&#x80FD;&#x5BF9;&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;&#x7684;&#x5217;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5904;&#x7406;</p>
<p><a href="https://spark.apache.org/docs/latest/api/python/pyspark.ml.html?highlight=stringindexer#pyspark.ml.feature.StringIndexer" target="_blank">StringIndexer</a>&#xFF1A;&#x5BF9;&#x6307;&#x5B9A;&#x5B57;&#x7B26;&#x4E32;&#x5217;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x7279;&#x5F81;&#x5904;&#x7406;&#xFF0C;&#x5982;&#x5C06;&#x6027;&#x522B;&#x6570;&#x636E;&#x201C;&#x7537;&#x201D;&#x3001;&#x201C;&#x5973;&#x201D;&#x8F6C;&#x5316;&#x4E3A;0&#x548C;1</p>
<p><a href="https://spark.apache.org/docs/latest/api/python/pyspark.ml.html?highlight=onehotencoder#pyspark.ml.feature.OneHotEncoder" target="_blank">OneHotEncoder</a>&#xFF1A;&#x5BF9;&#x7279;&#x5F81;&#x5217;&#x6570;&#x636E;&#xFF0C;&#x8FDB;&#x884C;&#x70ED;&#x7F16;&#x7801;&#xFF0C;&#x901A;&#x5E38;&#x9700;&#x7ED3;&#x5408;StringIndexer&#x4E00;&#x8D77;&#x4F7F;&#x7528;</p>
<p><a href="https://spark.apache.org/docs/latest/api/python/pyspark.ml.html?highlight=pipeline#pyspark.ml.Pipeline" target="_blank">Pipeline</a>&#xFF1A;&#x8BA9;&#x6570;&#x636E;&#x6309;&#x987A;&#x5E8F;&#x4F9D;&#x6B21;&#x88AB;&#x5904;&#x7406;&#xFF0C;&#x5C06;&#x524D;&#x4E00;&#x6B21;&#x7684;&#x5904;&#x7406;&#x7ED3;&#x679C;&#x4F5C;&#x4E3A;&#x4E0B;&#x4E00;&#x6B21;&#x7684;&#x8F93;&#x5165;</p>
</li>
</ul>
</li>
<li><p>&#x7279;&#x5F81;&#x5904;&#x7406;</p>
</li>
</ul>
<pre><code class="lang-python"><span class="hljs-string">&apos;&apos;&apos;&#x7279;&#x5F81;&#x5904;&#x7406;&apos;&apos;&apos;</span>
<span class="hljs-string">&apos;&apos;&apos;
pid &#x8D44;&#x6E90;&#x4F4D;&#x3002;&#x8BE5;&#x7279;&#x5F81;&#x5C5E;&#x4E8E;&#x5206;&#x7C7B;&#x7279;&#x5F81;&#xFF0C;&#x53EA;&#x6709;&#x4E24;&#x7C7B;&#x53D6;&#x503C;&#xFF0C;&#x56E0;&#x6B64;&#x8003;&#x8651;&#x8FDB;&#x884C;&#x70ED;&#x7F16;&#x7801;&#x5904;&#x7406;&#x5373;&#x53EF;&#xFF0C;&#x5206;&#x4E3A;&#x662F;&#x5426;&#x5728;&#x8D44;&#x6E90;&#x4F4D;1&#x3001;&#x662F;&#x5426;&#x5728;&#x8D44;&#x6E90;&#x4F4D;2 &#x4E24;&#x4E2A;&#x7279;&#x5F81;
&apos;&apos;&apos;</span>
<span class="hljs-keyword">from</span> pyspark.ml.feature <span class="hljs-keyword">import</span> OneHotEncoder
<span class="hljs-keyword">from</span> pyspark.ml.feature <span class="hljs-keyword">import</span> StringIndexer
<span class="hljs-keyword">from</span> pyspark.ml <span class="hljs-keyword">import</span> Pipeline

<span class="hljs-comment"># StringIndexer&#x5BF9;&#x6307;&#x5B9A;&#x5B57;&#x7B26;&#x4E32;&#x5217;&#x8FDB;&#x884C;&#x7279;&#x5F81;&#x5904;&#x7406;</span>
stringindexer = StringIndexer(inputCol=<span class="hljs-string">&apos;pid&apos;</span>, outputCol=<span class="hljs-string">&apos;pid_feature&apos;</span>)

<span class="hljs-comment"># &#x5BF9;&#x5904;&#x7406;&#x51FA;&#x6765;&#x7684;&#x7279;&#x5F81;&#x5904;&#x7406;&#x5217;&#x8FDB;&#x884C;&#xFF0C;&#x70ED;&#x72EC;&#x7F16;&#x7801;</span>
encoder = OneHotEncoder(dropLast=<span class="hljs-keyword">False</span>, inputCol=<span class="hljs-string">&apos;pid_feature&apos;</span>, outputCol=<span class="hljs-string">&apos;pid_value&apos;</span>)
<span class="hljs-comment"># &#x5229;&#x7528;&#x7BA1;&#x9053;&#x5BF9;&#x6BCF;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x70ED;&#x72EC;&#x7F16;&#x7801;&#x5904;&#x7406;</span>
pipeline = Pipeline(stages=[stringindexer, encoder])
pipeline_model = pipeline.fit(raw_sample_df)
new_df = pipeline_model.transform(raw_sample_df)
new_df.show()
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code>+------+----------+---------+-----------+------+---+-----------+-------------+
|userId| timestamp|adgroupId|        pid|nonclk|clk|pid_feature|    pid_value|
+------+----------+---------+-----------+------+---+-----------+-------------+
|581738|1494137644|        1|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|449818|1494638778|        3|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|914836|1494650879|        4|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|914836|1494651029|        5|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|399907|1494302958|        8|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|628137|1494524935|        9|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|298139|1494462593|        9|430539_1007|     1|  0|        1.0|(2,[1],[1.0])|
|775475|1494561036|        9|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|555266|1494307136|       11|430539_1007|     1|  0|        1.0|(2,[1],[1.0])|
|117840|1494036743|       11|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|739815|1494115387|       11|430539_1007|     1|  0|        1.0|(2,[1],[1.0])|
|623911|1494625301|       11|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|623911|1494451608|       11|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|421590|1494034144|       11|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|976358|1494156949|       13|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|286630|1494218579|       13|430539_1007|     1|  0|        1.0|(2,[1],[1.0])|
|286630|1494289247|       13|430539_1007|     1|  0|        1.0|(2,[1],[1.0])|
|771431|1494153867|       13|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|707120|1494220810|       13|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|530454|1494293746|       13|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
+------+----------+---------+-----------+------+---+-----------+-------------+
only showing top 20 rows
</code></pre><ul>
<li>&#x8FD4;&#x56DE;&#x5B57;&#x6BB5;pid_value&#x662F;&#x4E00;&#x4E2A;&#x7A00;&#x758F;&#x5411;&#x91CF;&#x7C7B;&#x578B;&#x6570;&#x636E; <a href="https://spark.apache.org/docs/latest/api/python/pyspark.ml.html?highlight=sparse#pyspark.ml.linalg.SparseVector" target="_blank">pyspark.ml.linalg.SparseVector</a></li>
</ul>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> pyspark.ml.linalg <span class="hljs-keyword">import</span> SparseVector
<span class="hljs-comment"># &#x53C2;&#x6570;&#xFF1A;&#x7EF4;&#x5EA6;&#x3001;&#x7D22;&#x5F15;&#x5217;&#x8868;&#x3001;&#x503C;&#x5217;&#x8868;</span>
print(SparseVector(<span class="hljs-number">4</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">3.0</span>, <span class="hljs-number">4.0</span>]))
print(SparseVector(<span class="hljs-number">4</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">3.0</span>, <span class="hljs-number">4.0</span>]).toArray())
print(<span class="hljs-string">&quot;*********&quot;</span>)
print(new_df.select(<span class="hljs-string">&quot;pid_value&quot;</span>).first())
print(new_df.select(<span class="hljs-string">&quot;pid_value&quot;</span>).first().pid_value.toArray())
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code>(4,[1,3],[3.0,4.0])
[0. 3. 0. 4.]
*********
Row(pid_value=SparseVector(2, {0: 1.0}))
[1. 0.]
</code></pre><ul>
<li>&#x67E5;&#x770B;&#x6700;&#x5927;&#x65F6;&#x95F4;</li>
</ul>
<pre><code class="lang-python">new_df.sort(<span class="hljs-string">&quot;timestamp&quot;</span>, ascending=<span class="hljs-keyword">False</span>).show()
</code></pre>
<pre><code class="lang-shell">+------+----------+---------+-----------+------+---+-----------+-------------+
|userId| timestamp|adgroupId|        pid|nonclk|clk|pid_feature|    pid_value|
+------+----------+---------+-----------+------+---+-----------+-------------+
|177002|1494691186|   593001|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|243671|1494691186|   600195|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|488527|1494691184|   494312|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|488527|1494691184|   431082|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
| 17054|1494691184|   742741|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
| 17054|1494691184|   756665|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|488527|1494691184|   687854|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|839493|1494691183|   561681|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|704223|1494691183|   624504|430539_1007|     1|  0|        1.0|(2,[1],[1.0])|
|839493|1494691183|   582235|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|704223|1494691183|   675674|430539_1007|     1|  0|        1.0|(2,[1],[1.0])|
|628998|1494691180|   618965|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|674444|1494691179|   427579|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|627200|1494691179|   782038|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|627200|1494691179|   420769|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|674444|1494691179|   588664|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|738335|1494691179|   451004|430539_1007|     1|  0|        1.0|(2,[1],[1.0])|
|627200|1494691179|   817569|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|322244|1494691179|   820018|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
|322244|1494691179|   735220|430548_1007|     1|  0|        0.0|(2,[0],[1.0])|
+------+----------+---------+-----------+------+---+-----------+-------------+
only showing top 20 rows
</code></pre>
<pre><code class="lang-python"><span class="hljs-comment"># &#x672C;&#x6837;&#x672C;&#x6570;&#x636E;&#x96C6;&#x5171;&#x8BA1;8&#x5929;&#x6570;&#x636E;</span>
<span class="hljs-comment"># &#x524D;&#x4E03;&#x5929;&#x4E3A;&#x8BAD;&#x7EC3;&#x6570;&#x636E;&#x3001;&#x6700;&#x540E;&#x4E00;&#x5929;&#x4E3A;&#x6D4B;&#x8BD5;&#x6570;&#x636E;</span>

<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
datetime.fromtimestamp(<span class="hljs-number">1494691186</span>)
print(<span class="hljs-string">&quot;&#x8BE5;&#x65F6;&#x95F4;&#x4E4B;&#x524D;&#x7684;&#x6570;&#x636E;&#x4E3A;&#x8BAD;&#x7EC3;&#x6837;&#x672C;&#xFF0C;&#x8BE5;&#x65F6;&#x95F4;&#x4EE5;&#x540E;&#x7684;&#x6570;&#x636E;&#x4E3A;&#x6D4B;&#x8BD5;&#x6837;&#x672C;&#xFF1A;&quot;</span>, datetime.fromtimestamp(<span class="hljs-number">1494691186</span><span class="hljs-number">-24</span>*<span class="hljs-number">60</span>*<span class="hljs-number">60</span>))
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code>&#x8BE5;&#x65F6;&#x95F4;&#x4E4B;&#x524D;&#x7684;&#x6570;&#x636E;&#x4E3A;&#x8BAD;&#x7EC3;&#x6837;&#x672C;&#xFF0C;&#x8BE5;&#x65F6;&#x95F4;&#x4EE5;&#x540E;&#x7684;&#x6570;&#x636E;&#x4E3A;&#x6D4B;&#x8BD5;&#x6837;&#x672C;&#xFF1A; 2017-05-12 23:59:46
</code></pre><ul>
<li>&#x8BAD;&#x7EC3;&#x6837;&#x672C;</li>
</ul>
<pre><code class="lang-python"><span class="hljs-comment"># &#x8BAD;&#x7EC3;&#x6837;&#x672C;&#xFF1A;</span>
train_sample = raw_sample_df.filter(raw_sample_df.timestamp&lt;=(<span class="hljs-number">1494691186</span><span class="hljs-number">-24</span>*<span class="hljs-number">60</span>*<span class="hljs-number">60</span>))
print(<span class="hljs-string">&quot;&#x8BAD;&#x7EC3;&#x6837;&#x672C;&#x4E2A;&#x6570;&#xFF1A;&quot;</span>)
print(train_sample.count())
<span class="hljs-comment"># &#x6D4B;&#x8BD5;&#x6837;&#x672C;</span>
test_sample = raw_sample_df.filter(raw_sample_df.timestamp&gt;(<span class="hljs-number">1494691186</span><span class="hljs-number">-24</span>*<span class="hljs-number">60</span>*<span class="hljs-number">60</span>))
print(<span class="hljs-string">&quot;&#x6D4B;&#x8BD5;&#x6837;&#x672C;&#x4E2A;&#x6570;&#xFF1A;&quot;</span>)
print(test_sample.count())

<span class="hljs-comment"># &#x6CE8;&#x610F;&#xFF1A;&#x8FD8;&#x9700;&#x8981;&#x52A0;&#x5165;&#x5E7F;&#x544A;&#x57FA;&#x672C;&#x7279;&#x5F81;&#x548C;&#x7528;&#x6237;&#x57FA;&#x672C;&#x7279;&#x5F81;&#x624D;&#x80FD;&#x505A;&#x7A0B;&#x4E00;&#x4EFD;&#x5B8C;&#x6574;&#x7684;&#x6837;&#x672C;&#x6570;&#x636E;&#x96C6;</span>
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code>&#x8BAD;&#x7EC3;&#x6837;&#x672C;&#x4E2A;&#x6570;&#xFF1A;
23249291
&#x6D4B;&#x8BD5;&#x6837;&#x672C;&#x4E2A;&#x6570;&#xFF1A;
3308670
</code></pre><h3 id="82-&#x5206;&#x6790;&#x5E76;&#x9884;&#x5904;&#x7406;adfeature&#x6570;&#x636E;&#x96C6;">8.2 &#x5206;&#x6790;&#x5E76;&#x9884;&#x5904;&#x7406;ad_feature&#x6570;&#x636E;&#x96C6;</h3>
<pre><code class="lang-python"><span class="hljs-comment"># &#x4ECE;HDFS&#x4E2D;&#x52A0;&#x8F7D;&#x5E7F;&#x544A;&#x57FA;&#x672C;&#x4FE1;&#x606F;&#x6570;&#x636E;&#xFF0C;&#x8FD4;&#x56DE;spark dafaframe&#x5BF9;&#x8C61;</span>
df = spark.read.csv(<span class="hljs-string">&quot;hdfs://localhost:9000/datasets/ad_feature.csv&quot;</span>, header=<span class="hljs-keyword">True</span>)
df.show()    <span class="hljs-comment"># &#x5C55;&#x793A;&#x6570;&#x636E;&#xFF0C;&#x9ED8;&#x8BA4;&#x524D;20&#x6761;</span>
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code class="lang-shell">+----------+-------+-----------+--------+------+-----+
|adgroup_id|cate_id|campaign_id|customer| brand|price|
+----------+-------+-----------+--------+------+-----+
|     63133|   6406|      83237|       1| 95471|170.0|
|    313401|   6406|      83237|       1| 87331|199.0|
|    248909|    392|      83237|       1| 32233| 38.0|
|    208458|    392|      83237|       1|174374|139.0|
|    110847|   7211|     135256|       2|145952|32.99|
|    607788|   6261|     387991|       6|207800|199.0|
|    375706|   4520|     387991|       6|  NULL| 99.0|
|     11115|   7213|     139747|       9|186847| 33.0|
|     24484|   7207|     139744|       9|186847| 19.0|
|     28589|   5953|     395195|      13|  NULL|428.0|
|     23236|   5953|     395195|      13|  NULL|368.0|
|    300556|   5953|     395195|      13|  NULL|639.0|
|     92560|   5953|     395195|      13|  NULL|368.0|
|    590965|   4284|      28145|      14|454237|249.0|
|    529913|   4284|      70206|      14|  NULL|249.0|
|    546930|   4284|      28145|      14|  NULL|249.0|
|    639794|   6261|      70206|      14| 37004| 89.9|
|    335413|   4284|      28145|      14|  NULL|249.0|
|    794890|   4284|      70206|      14|454237|249.0|
|    684020|   6261|      70206|      14| 37004| 99.0|
+----------+-------+-----------+--------+------+-----+
only showing top 20 rows
</code></pre>
<pre><code class="lang-python"><span class="hljs-comment"># &#x6CE8;&#x610F;&#xFF1A;&#x7531;&#x4E8E;&#x672C;&#x6570;&#x636E;&#x96C6;&#x4E2D;&#x5B58;&#x5728;NULL&#x5B57;&#x6837;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x65E0;&#x6CD5;&#x76F4;&#x63A5;&#x8BBE;&#x7F6E;schema&#xFF0C;&#x53EA;&#x80FD;&#x5148;&#x5C06;NULL&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#x5904;&#x7406;&#x6389;&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x884C;&#x7C7B;&#x578B;&#x8F6C;&#x6362;</span>

<span class="hljs-keyword">from</span> pyspark.sql.types <span class="hljs-keyword">import</span> StructType, StructField, IntegerType, FloatType

<span class="hljs-comment"># &#x66FF;&#x6362;&#x6389;NULL&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x66FF;&#x6362;&#x6389;</span>
df = df.replace(<span class="hljs-string">&quot;NULL&quot;</span>, <span class="hljs-string">&quot;-1&quot;</span>)

<span class="hljs-comment"># &#x6253;&#x5370;df&#x7ED3;&#x6784;&#x4FE1;&#x606F;</span>
df.printSchema()   
<span class="hljs-comment"># &#x66F4;&#x6539;df&#x8868;&#x7ED3;&#x6784;&#xFF1A;&#x66F4;&#x6539;&#x5217;&#x7C7B;&#x578B;&#x548C;&#x5217;&#x540D;&#x79F0;</span>
ad_feature_df = df.\
    withColumn(<span class="hljs-string">&quot;adgroup_id&quot;</span>, df.adgroup_id.cast(IntegerType())).withColumnRenamed(<span class="hljs-string">&quot;adgroup_id&quot;</span>, <span class="hljs-string">&quot;adgroupId&quot;</span>).\
    withColumn(<span class="hljs-string">&quot;cate_id&quot;</span>, df.cate_id.cast(IntegerType())).withColumnRenamed(<span class="hljs-string">&quot;cate_id&quot;</span>, <span class="hljs-string">&quot;cateId&quot;</span>).\
    withColumn(<span class="hljs-string">&quot;campaign_id&quot;</span>, df.campaign_id.cast(IntegerType())).withColumnRenamed(<span class="hljs-string">&quot;campaign_id&quot;</span>, <span class="hljs-string">&quot;campaignId&quot;</span>).\
    withColumn(<span class="hljs-string">&quot;customer&quot;</span>, df.customer.cast(IntegerType())).withColumnRenamed(<span class="hljs-string">&quot;customer&quot;</span>, <span class="hljs-string">&quot;customerId&quot;</span>).\
    withColumn(<span class="hljs-string">&quot;brand&quot;</span>, df.brand.cast(IntegerType())).withColumnRenamed(<span class="hljs-string">&quot;brand&quot;</span>, <span class="hljs-string">&quot;brandId&quot;</span>).\
    withColumn(<span class="hljs-string">&quot;price&quot;</span>, df.price.cast(FloatType()))
ad_feature_df.printSchema()
ad_feature_df.show()
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code class="lang-shell">root
 |-- adgroup_id: string (nullable = true)
 |-- cate_id: string (nullable = true)
 |-- campaign_id: string (nullable = true)
 |-- customer: string (nullable = true)
 |-- brand: string (nullable = true)
 |-- price: string (nullable = true)

root
 |-- adgroupId: integer (nullable = true)
 |-- cateId: integer (nullable = true)
 |-- campaignId: integer (nullable = true)
 |-- customerId: integer (nullable = true)
 |-- brandId: integer (nullable = true)
 |-- price: float (nullable = true)

+---------+------+----------+----------+-------+-----+
|adgroupId|cateId|campaignId|customerId|brandId|price|
+---------+------+----------+----------+-------+-----+
|    63133|  6406|     83237|         1|  95471|170.0|
|   313401|  6406|     83237|         1|  87331|199.0|
|   248909|   392|     83237|         1|  32233| 38.0|
|   208458|   392|     83237|         1| 174374|139.0|
|   110847|  7211|    135256|         2| 145952|32.99|
|   607788|  6261|    387991|         6| 207800|199.0|
|   375706|  4520|    387991|         6|     -1| 99.0|
|    11115|  7213|    139747|         9| 186847| 33.0|
|    24484|  7207|    139744|         9| 186847| 19.0|
|    28589|  5953|    395195|        13|     -1|428.0|
|    23236|  5953|    395195|        13|     -1|368.0|
|   300556|  5953|    395195|        13|     -1|639.0|
|    92560|  5953|    395195|        13|     -1|368.0|
|   590965|  4284|     28145|        14| 454237|249.0|
|   529913|  4284|     70206|        14|     -1|249.0|
|   546930|  4284|     28145|        14|     -1|249.0|
|   639794|  6261|     70206|        14|  37004| 89.9|
|   335413|  4284|     28145|        14|     -1|249.0|
|   794890|  4284|     70206|        14| 454237|249.0|
|   684020|  6261|     70206|        14|  37004| 99.0|
+---------+------+----------+----------+-------+-----+
only showing top 20 rows
</code></pre>
<ul>
<li>&#x67E5;&#x770B;&#x5404;&#x9879;&#x6570;&#x636E;&#x7684;&#x7279;&#x5F81;</li>
</ul>
<pre><code class="lang-python">print(<span class="hljs-string">&quot;&#x603B;&#x5E7F;&#x544A;&#x6761;&#x6570;&#xFF1A;&quot;</span>,df.count())   <span class="hljs-comment"># &#x6570;&#x636E;&#x6761;&#x6570;</span>
_1 = ad_feature_df.groupBy(<span class="hljs-string">&quot;cateId&quot;</span>).count().count()
print(<span class="hljs-string">&quot;cateId&#x6570;&#x503C;&#x4E2A;&#x6570;&#xFF1A;&quot;</span>, _1)
_2 = ad_feature_df.groupBy(<span class="hljs-string">&quot;campaignId&quot;</span>).count().count()
print(<span class="hljs-string">&quot;campaignId&#x6570;&#x503C;&#x4E2A;&#x6570;&#xFF1A;&quot;</span>, _2)
_3 = ad_feature_df.groupBy(<span class="hljs-string">&quot;customerId&quot;</span>).count().count()
print(<span class="hljs-string">&quot;customerId&#x6570;&#x503C;&#x4E2A;&#x6570;&#xFF1A;&quot;</span>, _3)
_4 = ad_feature_df.groupBy(<span class="hljs-string">&quot;brandId&quot;</span>).count().count()
print(<span class="hljs-string">&quot;brandId&#x6570;&#x503C;&#x4E2A;&#x6570;&#xFF1A;&quot;</span>, _4)
ad_feature_df.sort(<span class="hljs-string">&quot;price&quot;</span>).show()
ad_feature_df.sort(<span class="hljs-string">&quot;price&quot;</span>, ascending=<span class="hljs-keyword">False</span>).show()
print(<span class="hljs-string">&quot;&#x4EF7;&#x683C;&#x9AD8;&#x4E8E;1w&#x7684;&#x6761;&#x76EE;&#x4E2A;&#x6570;&#xFF1A;&quot;</span>, ad_feature_df.select(<span class="hljs-string">&quot;price&quot;</span>).filter(<span class="hljs-string">&quot;price&gt;10000&quot;</span>).count())
print(<span class="hljs-string">&quot;&#x4EF7;&#x683C;&#x4F4E;&#x4E8E;1&#x7684;&#x6761;&#x76EE;&#x4E2A;&#x6570;&quot;</span>, ad_feature_df.select(<span class="hljs-string">&quot;price&quot;</span>).filter(<span class="hljs-string">&quot;price&lt;1&quot;</span>).count())
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code>&#x603B;&#x5E7F;&#x544A;&#x6761;&#x6570;&#xFF1A; 846811
cateId&#x6570;&#x503C;&#x4E2A;&#x6570;&#xFF1A; 6769
campaignId&#x6570;&#x503C;&#x4E2A;&#x6570;&#xFF1A; 423436
customerId&#x6570;&#x503C;&#x4E2A;&#x6570;&#xFF1A; 255875
brandId&#x6570;&#x503C;&#x4E2A;&#x6570;&#xFF1A; 99815
+---------+------+----------+----------+-------+-----+
|adgroupId|cateId|campaignId|customerId|brandId|price|
+---------+------+----------+----------+-------+-----+
|   485749|  9970|    352666|    140520|     -1| 0.01|
|    88975|  9996|    198424|    182415|     -1| 0.01|
|   109704| 10539|     59774|     90351| 202710| 0.01|
|    49911|  7032|    129079|    172334|     -1| 0.01|
|   339334|  9994|    310408|    211292| 383023| 0.01|
|     6636|  6703|    392038|     46239| 406713| 0.01|
|    92241|  6130|     72781|    149714|     -1| 0.01|
|    20397| 10539|    410958|     65726|  79971| 0.01|
|   345870|  9995|    179595|    191036|  79971| 0.01|
|    77797|  9086|    218276|     31183|     -1| 0.01|
|    14435|  1136|    135610|     17788|     -1| 0.01|
|    42055|  9994|     43866|    113068| 123242| 0.01|
|    41925|  7032|     85373|    114532|     -1| 0.01|
|    67558|  9995|     90141|     83948|     -1| 0.01|
|   149570|  7043|    126746|    176076|     -1| 0.01|
|   518883|  7185|    403318|     58013|     -1| 0.01|
|     2246|  9996|    413653|     60214| 182966| 0.01|
|   290675|  4824|    315371|    240984|     -1| 0.01|
|   552638| 10305|    403318|     58013|     -1| 0.01|
|    89831| 10539|     90141|     83948| 211816| 0.01|
+---------+------+----------+----------+-------+-----+
only showing top 20 rows

+---------+------+----------+----------+-------+-----------+
|adgroupId|cateId|campaignId|customerId|brandId|      price|
+---------+------+----------+----------+-------+-----------+
|   658722|  1093|    218101|    207754|     -1|      1.0E8|
|   468220|  1093|    270719|    207754|     -1|      1.0E8|
|   179746|  1093|    270027|    102509| 405447|      1.0E8|
|   443295|  1093|     44251|    102509| 300681|      1.0E8|
|    31899|   685|    218918|     31239| 278301|      1.0E8|
|   243384|   685|    218918|     31239| 278301|      1.0E8|
|   554311|  1093|    266086|    207754|     -1|      1.0E8|
|   513942|   745|      8401|     86243|     -1|8.8888888E7|
|   201060|   745|      8401|     86243|     -1|5.5555556E7|
|   289563|   685|     37665|    120847| 278301|      1.5E7|
|    35156|   527|    417722|     72273| 278301|      1.0E7|
|    33756|   527|    416333|     70894|     -1|  9900000.0|
|   335495|   739|    170121|    148946| 326126|  9600000.0|
|   218306|   206|    162394|      4339| 221720|  8888888.0|
|   213567|  7213|    239302|    205612| 406125|  5888888.0|
|   375920|   527|    217512|    148946| 326126|  4760000.0|
|   262215|   527|    132721|     11947| 417898|  3980000.0|
|   154623|   739|    170121|    148946| 326126|  3900000.0|
|   152414|   739|    170121|    148946| 326126|  3900000.0|
|   448651|   527|    422260|     41289| 209959|  3800000.0|
+---------+------+----------+----------+-------+-----------+
only showing top 20 rows

&#x4EF7;&#x683C;&#x9AD8;&#x4E8E;1w&#x7684;&#x6761;&#x76EE;&#x4E2A;&#x6570;&#xFF1A; 6527
&#x4EF7;&#x683C;&#x4F4E;&#x4E8E;1&#x7684;&#x6761;&#x76EE;&#x4E2A;&#x6570; 5762
</code></pre><ul>
<li><p>&#x7279;&#x5F81;&#x9009;&#x62E9;</p>
<ul>
<li>cateId&#xFF1A;&#x8131;&#x654F;&#x8FC7;&#x7684;&#x5546;&#x54C1;&#x7C7B;&#x76EE;ID&#xFF1B;</li>
<li>campaignId&#xFF1A;&#x8131;&#x654F;&#x8FC7;&#x7684;&#x5E7F;&#x544A;&#x8BA1;&#x5212;ID&#xFF1B;</li>
<li>customerId:&#x8131;&#x654F;&#x8FC7;&#x7684;&#x5E7F;&#x544A;&#x4E3B;ID&#xFF1B;</li>
<li>brandId&#xFF1A;&#x8131;&#x654F;&#x8FC7;&#x7684;&#x54C1;&#x724C;ID&#xFF1B;</li>
</ul>
<p>&#x4EE5;&#x4E0A;&#x56DB;&#x4E2A;&#x7279;&#x5F81;&#x5747;&#x5C5E;&#x4E8E;&#x5206;&#x7C7B;&#x7279;&#x5F81;&#xFF0C;&#x4F46;&#x7531;&#x4E8E;&#x5206;&#x7C7B;&#x503C;&#x4E2A;&#x6570;&#x5747;&#x8FC7;&#x4E8E;&#x5E9E;&#x5927;&#xFF0C;&#x5982;&#x679C;&#x53BB;&#x505A;&#x70ED;&#x72EC;&#x7F16;&#x7801;&#x5904;&#x7406;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x6570;&#x636E;&#x8FC7;&#x4E8E;&#x7A00;&#x758F; &#x4E14;&#x5F53;&#x524D;&#x6211;&#x4EEC;&#x7F3A;&#x5C11;&#x5BF9;&#x8FD9;&#x4E9B;&#x7279;&#x5F81;&#x66F4;&#x52A0;&#x5177;&#x4F53;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#xFF08;&#x5982;&#x5546;&#x54C1;&#x7C7B;&#x76EE;&#x5177;&#x4F53;&#x4FE1;&#x606F;&#x3001;&#x54C1;&#x724C;&#x5177;&#x4F53;&#x4FE1;&#x606F;&#x7B49;&#xFF09;&#xFF0C;&#x4ECE;&#x800C;&#x65E0;&#x6CD5;&#x5BF9;&#x8FD9;&#x4E9B;&#x7279;&#x5F81;&#x7684;&#x6570;&#x636E;&#x505A;&#x805A;&#x7C7B;&#x3001;&#x964D;&#x7EF4;&#x5904;&#x7406; &#x56E0;&#x6B64;&#x8FD9;&#x91CC;&#x4E0D;&#x9009;&#x53D6;&#x5B83;&#x4EEC;&#x4F5C;&#x4E3A;&#x7279;&#x5F81;</p>
<p>&#x800C;&#x53EA;&#x9009;&#x53D6;price&#x4F5C;&#x4E3A;&#x7279;&#x5F81;&#x6570;&#x636E;&#xFF0C;&#x56E0;&#x4E3A;&#x4EF7;&#x683C;&#x672C;&#x8EAB;&#x662F;&#x4E00;&#x4E2A;&#x7EDF;&#x8BA1;&#x7C7B;&#x578B;&#x8FDE;&#x7EED;&#x6570;&#x503C;&#x578B;&#x6570;&#x636E;&#xFF0C;&#x4E14;&#x80FD;&#x5F88;&#x597D;&#x7684;&#x4F53;&#x73B0;&#x5E7F;&#x544A;&#x7684;&#x4EF7;&#x503C;&#x5C5E;&#x6027;&#x7279;&#x5F81;&#xFF0C;&#x901A;&#x5E38;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x505A;&#x5176;&#x4ED6;&#x5904;&#x7406;(&#x79BB;&#x6563;&#x5316;&#x3001;&#x5F52;&#x4E00;&#x5316;&#x3001;&#x6807;&#x51C6;&#x5316;&#x7B49;)&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x76F4;&#x63A5;&#x5C06;&#x5F53;&#x505A;&#x7279;&#x5F81;&#x6570;&#x636E;&#x6765;&#x4F7F;&#x7528;</p>
</li>
</ul>
<h3 id="83-&#x5206;&#x6790;&#x5E76;&#x9884;&#x5904;&#x7406;userprofile&#x6570;&#x636E;&#x96C6;">8.3 &#x5206;&#x6790;&#x5E76;&#x9884;&#x5904;&#x7406;user_profile&#x6570;&#x636E;&#x96C6;</h3>
<pre><code class="lang-python"><span class="hljs-comment"># &#x4ECE;HDFS&#x52A0;&#x8F7D;&#x7528;&#x6237;&#x57FA;&#x672C;&#x4FE1;&#x606F;&#x6570;&#x636E;</span>
df = spark.read.csv(<span class="hljs-string">&quot;hdfs://localhost:8020/csv/user_profile.csv&quot;</span>, header=<span class="hljs-keyword">True</span>)
<span class="hljs-comment"># &#x53D1;&#x73B0;pvalue_level&#x548C;new_user_class_level&#x5B58;&#x5728;&#x7A7A;&#x503C;&#xFF1A;&#xFF08;&#x6CE8;&#x610F;&#x6B64;&#x5904;&#x7684;null&#x8868;&#x793A;&#x7A7A;&#x503C;&#xFF0C;&#x800C;&#x5982;&#x679C;&#x662F;NULL&#xFF0C;&#x5219;&#x5F80;&#x5F80;&#x8868;&#x793A;&#x662F;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF09;</span>
<span class="hljs-comment"># &#x56E0;&#x6B64;&#x76F4;&#x63A5;&#x5229;&#x7528;schema&#x5C31;&#x53EF;&#x4EE5;&#x52A0;&#x8F7D;&#x8FDB;&#x8BE5;&#x6570;&#x636E;&#xFF0C;&#x65E0;&#x9700;&#x66FF;&#x6362;null&#x503C;</span>
df.show()
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code class="lang-shell">+------+---------+------------+-----------------+---------+------------+--------------+----------+---------------------+
|userid|cms_segid|cms_group_id|final_gender_code|age_level|pvalue_level|shopping_level|occupation|new_user_class_level |
+------+---------+------------+-----------------+---------+------------+--------------+----------+---------------------+
|   234|        0|           5|                2|        5|        null|             3|         0|                    3|
|   523|        5|           2|                2|        2|           1|             3|         1|                    2|
|   612|        0|           8|                1|        2|           2|             3|         0|                 null|
|  1670|        0|           4|                2|        4|        null|             1|         0|                 null|
|  2545|        0|          10|                1|        4|        null|             3|         0|                 null|
|  3644|       49|           6|                2|        6|           2|             3|         0|                    2|
|  5777|       44|           5|                2|        5|           2|             3|         0|                    2|
|  6211|        0|           9|                1|        3|        null|             3|         0|                    2|
|  6355|        2|           1|                2|        1|           1|             3|         0|                    4|
|  6823|       43|           5|                2|        5|           2|             3|         0|                    1|
|  6972|        5|           2|                2|        2|           2|             3|         1|                    2|
|  9293|        0|           5|                2|        5|        null|             3|         0|                    4|
|  9510|       55|           8|                1|        2|           2|             2|         0|                    2|
| 10122|       33|           4|                2|        4|           2|             3|         0|                    2|
| 10549|        0|           4|                2|        4|           2|             3|         0|                 null|
| 10812|        0|           4|                2|        4|        null|             2|         0|                 null|
| 10912|        0|           4|                2|        4|           2|             3|         0|                 null|
| 10996|        0|           5|                2|        5|        null|             3|         0|                    4|
| 11256|        8|           2|                2|        2|           1|             3|         0|                    3|
| 11310|       31|           4|                2|        4|           1|             3|         0|                    4|
+------+---------+------------+-----------------+---------+------------+--------------+----------+---------------------+
</code></pre>
<pre><code class="lang-python"><span class="hljs-comment"># &#x6CE8;&#x610F;&#xFF1A;&#x8FD9;&#x91CC;&#x7684;null&#x4F1A;&#x76F4;&#x63A5;&#x88AB;pyspark&#x8BC6;&#x522B;&#x4E3A;None&#x6570;&#x636E;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;na&#x6570;&#x636E;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5229;&#x7528;schema&#x5BFC;&#x5165;&#x6570;&#x636E;</span>

<span class="hljs-keyword">from</span> pyspark.sql.types <span class="hljs-keyword">import</span> StructType, StructField, StringType, IntegerType, LongType, FloatType

<span class="hljs-comment"># &#x6784;&#x5EFA;&#x8868;&#x7ED3;&#x6784;schema&#x5BF9;&#x8C61;</span>
schema = StructType([
    StructField(<span class="hljs-string">&quot;userId&quot;</span>, IntegerType()),
    StructField(<span class="hljs-string">&quot;cms_segid&quot;</span>, IntegerType()),
    StructField(<span class="hljs-string">&quot;cms_group_id&quot;</span>, IntegerType()),
    StructField(<span class="hljs-string">&quot;final_gender_code&quot;</span>, IntegerType()),
    StructField(<span class="hljs-string">&quot;age_level&quot;</span>, IntegerType()),
    StructField(<span class="hljs-string">&quot;pvalue_level&quot;</span>, IntegerType()),
    StructField(<span class="hljs-string">&quot;shopping_level&quot;</span>, IntegerType()),
    StructField(<span class="hljs-string">&quot;occupation&quot;</span>, IntegerType()),
    StructField(<span class="hljs-string">&quot;new_user_class_level&quot;</span>, IntegerType())
])
<span class="hljs-comment"># &#x5229;&#x7528;schema&#x4ECE;hdfs&#x52A0;&#x8F7D;</span>
user_profile_df = spark.read.csv(<span class="hljs-string">&quot;hdfs://localhost:8020/csv/user_profile.csv&quot;</span>, header=<span class="hljs-keyword">True</span>, schema=schema)
user_profile_df.printSchema()
user_profile_df.show()
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code class="lang-shell">root
 |-- userId: integer (nullable = true)
 |-- cms_segid: integer (nullable = true)
 |-- cms_group_id: integer (nullable = true)
 |-- final_gender_code: integer (nullable = true)
 |-- age_level: integer (nullable = true)
 |-- pvalue_level: integer (nullable = true)
 |-- shopping_level: integer (nullable = true)
 |-- occupation: integer (nullable = true)
 |-- new_user_class_level: integer (nullable = true)

+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+
|userId|cms_segid|cms_group_id|final_gender_code|age_level|pvalue_level|shopping_level|occupation|new_user_class_level|
+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+
|   234|        0|           5|                2|        5|        null|             3|         0|                   3|
|   523|        5|           2|                2|        2|           1|             3|         1|                   2|
|   612|        0|           8|                1|        2|           2|             3|         0|                null|
|  1670|        0|           4|                2|        4|        null|             1|         0|                null|
|  2545|        0|          10|                1|        4|        null|             3|         0|                null|
|  3644|       49|           6|                2|        6|           2|             3|         0|                   2|
|  5777|       44|           5|                2|        5|           2|             3|         0|                   2|
|  6211|        0|           9|                1|        3|        null|             3|         0|                   2|
|  6355|        2|           1|                2|        1|           1|             3|         0|                   4|
|  6823|       43|           5|                2|        5|           2|             3|         0|                   1|
|  6972|        5|           2|                2|        2|           2|             3|         1|                   2|
|  9293|        0|           5|                2|        5|        null|             3|         0|                   4|
|  9510|       55|           8|                1|        2|           2|             2|         0|                   2|
| 10122|       33|           4|                2|        4|           2|             3|         0|                   2|
| 10549|        0|           4|                2|        4|           2|             3|         0|                null|
| 10812|        0|           4|                2|        4|        null|             2|         0|                null|
| 10912|        0|           4|                2|        4|           2|             3|         0|                null|
| 10996|        0|           5|                2|        5|        null|             3|         0|                   4|
| 11256|        8|           2|                2|        2|           1|             3|         0|                   3|
| 11310|       31|           4|                2|        4|           1|             3|         0|                   4|
+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+
only showing top 20 rows
</code></pre>
<ul>
<li>&#x663E;&#x793A;&#x7279;&#x5F81;&#x60C5;&#x51B5;</li>
</ul>
<pre><code class="lang-python">print(<span class="hljs-string">&quot;&#x5206;&#x7C7B;&#x7279;&#x5F81;&#x503C;&#x4E2A;&#x6570;&#x60C5;&#x51B5;: &quot;</span>)
print(<span class="hljs-string">&quot;cms_segid: &quot;</span>, user_profile_df.groupBy(<span class="hljs-string">&quot;cms_segid&quot;</span>).count().count())
print(<span class="hljs-string">&quot;cms_group_id: &quot;</span>, user_profile_df.groupBy(<span class="hljs-string">&quot;cms_group_id&quot;</span>).count().count())
print(<span class="hljs-string">&quot;final_gender_code: &quot;</span>, user_profile_df.groupBy(<span class="hljs-string">&quot;final_gender_code&quot;</span>).count().count())
print(<span class="hljs-string">&quot;age_level: &quot;</span>, user_profile_df.groupBy(<span class="hljs-string">&quot;age_level&quot;</span>).count().count())
print(<span class="hljs-string">&quot;shopping_level: &quot;</span>, user_profile_df.groupBy(<span class="hljs-string">&quot;shopping_level&quot;</span>).count().count())
print(<span class="hljs-string">&quot;occupation: &quot;</span>, user_profile_df.groupBy(<span class="hljs-string">&quot;occupation&quot;</span>).count().count())

print(<span class="hljs-string">&quot;&#x542B;&#x7F3A;&#x5931;&#x503C;&#x7684;&#x7279;&#x5F81;&#x60C5;&#x51B5;: &quot;</span>)
user_profile_df.groupBy(<span class="hljs-string">&quot;pvalue_level&quot;</span>).count().show()
user_profile_df.groupBy(<span class="hljs-string">&quot;new_user_class_level&quot;</span>).count().show()

t_count = user_profile_df.count()
pl_na_count = t_count - user_profile_df.dropna(subset=[<span class="hljs-string">&quot;pvalue_level&quot;</span>]).count()
print(<span class="hljs-string">&quot;pvalue_level&#x7684;&#x7A7A;&#x503C;&#x60C5;&#x51B5;&#xFF1A;&quot;</span>, pl_na_count, <span class="hljs-string">&quot;&#x7A7A;&#x503C;&#x5360;&#x6BD4;&#xFF1A;%0.2f%%&quot;</span>%(pl_na_count/t_count*<span class="hljs-number">100</span>))
nul_na_count = t_count - user_profile_df.dropna(subset=[<span class="hljs-string">&quot;new_user_class_level&quot;</span>]).count()
print(<span class="hljs-string">&quot;new_user_class_level&#x7684;&#x7A7A;&#x503C;&#x60C5;&#x51B5;&#xFF1A;&quot;</span>, nul_na_count, <span class="hljs-string">&quot;&#x7A7A;&#x503C;&#x5360;&#x6BD4;&#xFF1A;%0.2f%%&quot;</span>%(nul_na_count/t_count*<span class="hljs-number">100</span>))
</code></pre>
<p>&#x663E;&#x793A;&#x5185;&#x5BB9;:</p>
<pre><code class="lang-shell">&#x5206;&#x7C7B;&#x7279;&#x5F81;&#x503C;&#x4E2A;&#x6570;&#x60C5;&#x51B5;: 
cms_segid:  97
cms_group_id:  13
final_gender_code:  2
age_level:  7
shopping_level:  3
occupation:  2
&#x542B;&#x7F3A;&#x5931;&#x503C;&#x7684;&#x7279;&#x5F81;&#x60C5;&#x51B5;: 
+------------+------+
|pvalue_level| count|
+------------+------+
|        null|575917|
|           1|154436|
|           3| 37759|
|           2|293656|
+------------+------+

+--------------------+------+
|new_user_class_level| count|
+--------------------+------+
|                null|344920|
|                   1| 80548|
|                   3|173047|
|                   4|138833|
|                   2|324420|
+--------------------+------+

pvalue_level&#x7684;&#x7A7A;&#x503C;&#x60C5;&#x51B5;&#xFF1A; 575917 &#x7A7A;&#x503C;&#x5360;&#x6BD4;&#xFF1A;54.24%
new_user_class_level&#x7684;&#x7A7A;&#x503C;&#x60C5;&#x51B5;&#xFF1A; 344920 &#x7A7A;&#x503C;&#x5360;&#x6BD4;&#xFF1A;32.49%
</code></pre>
<ul>
<li><p>&#x7F3A;&#x5931;&#x503C;&#x5904;&#x7406;</p>
<ul>
<li><p>&#x6CE8;&#x610F;&#xFF0C;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x7F3A;&#x5931;&#x7387;&#x4F4E;&#x4E8E;10%&#xFF1A;&#x53EF;&#x76F4;&#x63A5;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x586B;&#x5145;&#xFF0C;&#x5982;&#x9ED8;&#x8BA4;&#x503C;&#x3001;&#x5747;&#x503C;&#x3001;&#x7B97;&#x6CD5;&#x62DF;&#x5408;&#x7B49;&#x7B49;&#xFF1B;</li>
<li>&#x9AD8;&#x4E8E;10%&#xFF1A;&#x5F80;&#x5F80;&#x4F1A;&#x8003;&#x8651;&#x820D;&#x5F03;&#x8BE5;&#x7279;&#x5F81;</li>
<li>&#x7279;&#x5F81;&#x5904;&#x7406;&#xFF0C;&#x5982;1&#x7EF4;&#x8F6C;&#x591A;&#x7EF4;</li>
</ul>
<p>&#x4F46;&#x6839;&#x636E;&#x6211;&#x4EEC;&#x7684;&#x7ECF;&#x9A8C;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x5E7F;&#x544A;&#x63A8;&#x8350;&#x5176;&#x5B9E;&#x548C;&#x7528;&#x6237;&#x7684;&#x6D88;&#x8D39;&#x6C34;&#x5E73;&#x3001;&#x7528;&#x6237;&#x6240;&#x5728;&#x57CE;&#x5E02;&#x7B49;&#x7EA7;&#x90FD;&#x6709;&#x6BD4;&#x8F83;&#x5927;&#x7684;&#x5173;&#x8054;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x8FD9;&#x91CC;pvalue_level&#x3001;new_user_class_level&#x90FD;&#x662F;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#x7279;&#x5F81;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x8003;&#x8651;&#x820D;&#x5F03;</p>
</li>
</ul>
</li>
<li><p>&#x7F3A;&#x5931;&#x503C;&#x5904;&#x7406;&#x65B9;&#x6848;&#xFF1A;</p>
<ul>
<li>&#x586B;&#x5145;&#x65B9;&#x6848;&#xFF1A;&#x7ED3;&#x5408;&#x7528;&#x6237;&#x7684;&#x5176;&#x4ED6;&#x7279;&#x5F81;&#x503C;&#xFF0C;&#x5229;&#x7528;&#x968F;&#x673A;&#x68EE;&#x6797;&#x7B97;&#x6CD5;&#x8FDB;&#x884C;&#x9884;&#x6D4B;&#xFF1B;&#x4F46;&#x4EA7;&#x751F;&#x4E86;&#x5927;&#x91CF;&#x4EBA;&#x4E3A;&#x6784;&#x5EFA;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x589E;&#x52A0;&#x4E86;&#x6570;&#x636E;&#x7684;&#x566A;&#x97F3;</li>
<li>&#x628A;&#x53D8;&#x91CF;&#x6620;&#x5C04;&#x5230;&#x9AD8;&#x7EF4;&#x7A7A;&#x95F4;&#xFF1A;&#x5982;pvalue_level&#x7684;1&#x7EF4;&#x6570;&#x636E;&#xFF0C;&#x8F6C;&#x6362;&#x6210;&#x662F;&#x5426;1&#x3001;&#x662F;&#x5426;2&#x3001;&#x662F;&#x5426;3&#x3001;&#x662F;&#x5426;&#x7F3A;&#x5931;&#x7684;4&#x7EF4;&#x6570;&#x636E;&#xFF1B;&#x8FD9;&#x6837;&#x4FDD;&#x8BC1;&#x4E86;&#x6240;&#x6709;&#x539F;&#x59CB;&#x6570;&#x636E;&#x4E0D;&#x53D8;&#xFF0C;&#x540C;&#x65F6;&#x80FD;&#x63D0;&#x9AD8;&#x7CBE;&#x786E;&#x5EA6;&#xFF0C;&#x4F46;&#x8FD9;&#x6837;&#x4F1A;&#x5BFC;&#x81F4;&#x6570;&#x636E;&#x53D8;&#x5F97;&#x6BD4;&#x8F83;&#x7A00;&#x758F;&#xFF0C;&#x5982;&#x679C;&#x6837;&#x672C;&#x91CF;&#x5F88;&#x5C0F;&#xFF0C;&#x53CD;&#x800C;&#x4F1A;&#x5BFC;&#x81F4;&#x6837;&#x672C;&#x6548;&#x679C;&#x8F83;&#x5DEE;&#xFF0C;&#x56E0;&#x6B64;&#x4E5F;&#x4E0D;&#x80FD;&#x6EE5;&#x7528;</li>
</ul>
</li>
<li><p>&#x586B;&#x5145;&#x65B9;&#x6848;</p>
<ul>
<li>&#x5229;&#x7528;&#x968F;&#x673A;&#x68EE;&#x6797;&#x5BF9;pvalue_level&#x7684;&#x7F3A;&#x5931;&#x503C;&#x8FDB;&#x884C;&#x9884;&#x6D4B;</li>
</ul>
</li>
</ul>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> pyspark.mllib.regression <span class="hljs-keyword">import</span> LabeledPoint

<span class="hljs-comment"># &#x5254;&#x9664;&#x6389;&#x7F3A;&#x5931;&#x503C;&#x6570;&#x636E;&#xFF0C;&#x5C06;&#x4F59;&#x4E0B;&#x7684;&#x6570;&#x636E;&#x4F5C;&#x4E3A;&#x8BAD;&#x7EC3;&#x6570;&#x636E;</span>
<span class="hljs-comment"># user_profile_df.dropna(subset=[&quot;pvalue_level&quot;])&#xFF1A; &#x5C06;pvalue_level&#x4E2D;&#x7684;&#x7A7A;&#x503C;&#x6240;&#x5728;&#x884C;&#x6570;&#x636E;&#x5254;&#x9664;&#x540E;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4F5C;&#x4E3A;&#x8BAD;&#x7EC3;&#x6837;&#x672C;</span>
train_data = user_profile_df.dropna(subset=[<span class="hljs-string">&quot;pvalue_level&quot;</span>]).rdd.map(
    <span class="hljs-keyword">lambda</span> r:LabeledPoint(r.pvalue_level<span class="hljs-number">-1</span>, [r.cms_segid, r.cms_group_id, r.final_gender_code, r.age_level, r.shopping_level, r.occupation])
)

<span class="hljs-comment"># &#x6CE8;&#x610F;&#x968F;&#x673A;&#x68EE;&#x6797;&#x8F93;&#x5165;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x7531;&#x4E8E;label&#x7684;&#x5206;&#x7C7B;&#x6570;&#x662F;&#x4ECE;0&#x5F00;&#x59CB;&#x7684;&#xFF0C;&#x4F46;pvalue_level&#x7684;&#x76EE;&#x524D;&#x53EA;&#x5206;&#x522B;&#x662F;1&#xFF0C;2&#xFF0C;3&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x5BF9;&#x5E94;&#x5206;&#x522B;-1&#x6765;&#x4F5C;&#x4E3A;&#x76EE;&#x6807;&#x503C;</span>
<span class="hljs-comment"># &#x81EA;&#x7136;&#x90A3;&#x4E48;&#x6700;&#x7EC8;&#x5F97;&#x51FA;&#x9884;&#x6D4B;&#x503C;&#x540E;&#xFF0C;&#x9700;&#x8981;&#x5BF9;&#x5E94;+1&#x624D;&#x80FD;&#x8FD8;&#x539F;&#x56DE;&#x6765;</span>

<span class="hljs-comment"># &#x6211;&#x4EEC;&#x4F7F;&#x7528;cms_segid, cms_group_id, final_gender_code, age_level, shopping_level, occupation&#x4F5C;&#x4E3A;&#x7279;&#x5F81;&#x503C;&#xFF0C;pvalue_level&#x4F5C;&#x4E3A;&#x76EE;&#x6807;&#x503C;</span>
</code></pre>
<ul>
<li>Labeled point</li>
</ul>
<p>A labeled point is a local vector, either dense or sparse, associated with a label/response. In MLlib, labeled points are used in supervised learning algorithms. We use a double to store a label, so we can use labeled points in both regression and classification. For binary classification, a label should be either 0 (negative) or 1 (positive). For multiclass classification, labels should be class indices starting from zero: 0, 1, 2, &#x2026;. 
&#x6807;&#x8BB0;&#x70B9;&#x662F;&#x4E0E;&#x6807;&#x7B7E;/&#x54CD;&#x5E94;&#x76F8;&#x5173;&#x8054;&#x7684;&#x5BC6;&#x96C6;&#x6216;&#x7A00;&#x758F;&#x7684;&#x5C40;&#x90E8;&#x77E2;&#x91CF;&#x3002;&#x5728;MLlib&#x4E2D;&#xFF0C;&#x6807;&#x8BB0;&#x70B9;&#x7528;&#x4E8E;&#x76D1;&#x7763;&#x5B66;&#x4E60;&#x7B97;&#x6CD5;&#x3002;&#x6211;&#x4EEC;&#x4F7F;&#x7528;double&#x6765;&#x5B58;&#x50A8;&#x6807;&#x7B7E;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x56DE;&#x5F52;&#x548C;&#x5206;&#x7C7B;&#x4E2D;&#x4F7F;&#x7528;&#x6807;&#x8BB0;&#x70B9;&#x3002;&#x5BF9;&#x4E8E;&#x4E8C;&#x8FDB;&#x5236;&#x5206;&#x7C7B;&#xFF0C;&#x6807;&#x7B7E;&#x5E94;&#x4E3A;0&#xFF08;&#x8D1F;&#xFF09;&#x6216;1&#xFF08;&#x6B63;&#xFF09;&#x3002;&#x5BF9;&#x4E8E;&#x591A;&#x7C7B;&#x5206;&#x7C7B;&#xFF0C;&#x6807;&#x7B7E;&#x5E94;&#x8BE5;&#x662F;&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;&#x7C7B;&#x7D22;&#x5F15;&#xFF1A;0, 1, 2, &#x2026;&#x3002;</p>
<p><strong>Python</strong> 
A labeled point is represented by LabeledPoint. 
&#x6807;&#x8BB0;&#x70B9;&#x8868;&#x793A;&#x4E3A; LabeledPoint&#x3002; 
Refer to the LabeledPoint Python docs for more details on the API. 
&#x6709;&#x5173;API&#x7684;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;LabeledPointPython&#x6587;&#x6863;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> pyspark.mllib.linalg <span class="hljs-keyword">import</span> SparseVector
<span class="hljs-keyword">from</span> pyspark.mllib.regression <span class="hljs-keyword">import</span> LabeledPoint

<span class="hljs-comment"># Create a labeled point with a positive label and a dense feature vector.</span>
pos = LabeledPoint(<span class="hljs-number">1.0</span>, [<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">3.0</span>])

<span class="hljs-comment"># Create a labeled point with a negative label and a sparse feature vector.</span>
neg = LabeledPoint(<span class="hljs-number">0.0</span>, SparseVector(<span class="hljs-number">3</span>, [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">1.0</span>, <span class="hljs-number">3.0</span>]))
</code></pre>
<ul>
<li>&#x968F;&#x673A;&#x68EE;&#x6797;&#xFF1A;<a href="https://spark.apache.org/docs/latest/api/python/pyspark.mllib.html?highlight=randomforest#pyspark.mllib.tree.RandomForest" target="_blank">pyspark.mllib.tree.RandomForest</a></li>
</ul>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> pyspark.mllib.tree <span class="hljs-keyword">import</span> RandomForest
<span class="hljs-comment"># &#x8BAD;&#x7EC3;&#x5206;&#x7C7B;&#x6A21;&#x578B;</span>
<span class="hljs-comment"># &#x53C2;&#x6570;1 &#x8BAD;&#x7EC3;&#x7684;&#x6570;&#x636E;</span>
<span class="hljs-comment">#&#x53C2;&#x6570;2 &#x76EE;&#x6807;&#x503C;&#x7684;&#x5206;&#x7C7B;&#x4E2A;&#x6570; 0,1,2</span>
<span class="hljs-comment">#&#x53C2;&#x6570;3 &#x7279;&#x5F81;&#x4E2D;&#x662F;&#x5426;&#x5305;&#x542B;&#x5206;&#x7C7B;&#x7684;&#x76EE;&#x6807; {2:2,3:7} {2:2} &#x8868;&#x793A; &#x5728;&#x7279;&#x5F81;&#x4E2D; &#x7B2C;&#x4E8C;&#x4E2A;&#x7279;&#x5F81;&#x662F;&#x5206;&#x7C7B;&#x7684;: &#x6709;&#x4E24;&#x4E2A;&#x5206;&#x7C7B;</span>
<span class="hljs-comment">#&#x53C2;&#x6570;4 &#x968F;&#x673A;&#x68EE;&#x6797;&#x4E2D; &#x6811;&#x7684;&#x68F5;&#x6570;</span>
model = RandomForest.trainClassifier(train_data, <span class="hljs-number">3</span>, {}, <span class="hljs-number">5</span>)
</code></pre>
<ul>
<li>&#x968F;&#x673A;&#x68EE;&#x6797;&#x6A21;&#x578B;&#xFF1A;<a href="https://spark.apache.org/docs/latest/api/python/pyspark.mllib.html?highlight=randomforest#pyspark.mllib.tree.RandomForestModel" target="_blank">pyspark.mllib.tree.RandomForestModel</a></li>
</ul>
<pre><code class="lang-python"><span class="hljs-comment"># &#x9884;&#x6D4B;&#x5355;&#x4E2A;&#x6570;&#x636E;</span>
<span class="hljs-comment"># &#x6CE8;&#x610F;&#x7528;&#x6CD5;&#xFF1A;https://spark.apache.org/docs/latest/api/python/pyspark.mllib.html?highlight=tree%20random#pyspark.mllib.tree.RandomForestModel.predict</span>
model.predict([<span class="hljs-number">0.0</span>, <span class="hljs-number">4.0</span> ,<span class="hljs-number">2.0</span> , <span class="hljs-number">4.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>])
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code class="lang-shell">1.0
</code></pre>
<ul>
<li>&#x7B5B;&#x9009;&#x51FA;&#x7F3A;&#x5931;&#x503C;&#x6761;&#x76EE;</li>
</ul>
<pre><code class="lang-python">pl_na_df = user_profile_df.na.fill(<span class="hljs-number">-1</span>).where(<span class="hljs-string">&quot;pvalue_level=-1&quot;</span>)
pl_na_df.show(<span class="hljs-number">10</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">row</span><span class="hljs-params">(r)</span>:</span>
    <span class="hljs-keyword">return</span> r.cms_segid, r.cms_group_id, r.final_gender_code, r.age_level, r.shopping_level, r.occupation

<span class="hljs-comment"># &#x8F6C;&#x6362;&#x4E3A;&#x666E;&#x901A;&#x7684;rdd&#x7C7B;&#x578B;</span>
rdd = pl_na_df.rdd.map(row)
<span class="hljs-comment"># &#x9884;&#x6D4B;&#x5168;&#x90E8;&#x7684;pvalue_level&#x503C;:</span>
predicts = model.predict(rdd)
<span class="hljs-comment"># &#x67E5;&#x770B;&#x524D;20&#x6761;</span>
print(predicts.take(<span class="hljs-number">20</span>))
print(<span class="hljs-string">&quot;&#x9884;&#x6D4B;&#x503C;&#x603B;&#x6570;&quot;</span>, predicts.count())

<span class="hljs-comment"># &#x8FD9;&#x91CC;&#x6CE8;&#x610F;predict&#x53C2;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x9884;&#x6D4B;&#x591A;&#x4E2A;&#xFF0C;&#x90A3;&#x4E48;&#x53C2;&#x6570;&#x5FC5;&#x987B;&#x662F;&#x76F4;&#x63A5;&#x6709;&#x5217;&#x8868;&#x6784;&#x6210;&#x7684;rdd&#x53C2;&#x6570;&#xFF0C;&#x800C;&#x4E0D;&#x80FD;&#x662F;dataframe.rdd&#x7C7B;&#x578B;</span>
<span class="hljs-comment"># &#x56E0;&#x6B64;&#x8FD9;&#x91CC;&#x7ECF;&#x8FC7;map&#x51FD;&#x6570;&#x5904;&#x7406;&#xFF0C;&#x5C06;&#x6BCF;&#x4E00;&#x884C;&#x6570;&#x636E;&#x8F6C;&#x6362;&#x4E3A;&#x666E;&#x901A;&#x7684;&#x5217;&#x8868;&#x6570;&#x636E;</span>
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code class="lang-shell">+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+
|userId|cms_segid|cms_group_id|final_gender_code|age_level|pvalue_level|shopping_level|occupation|new_user_class_level|
+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+
|   234|        0|           5|                2|        5|          -1|             3|         0|                   3|
|  1670|        0|           4|                2|        4|          -1|             1|         0|                  -1|
|  2545|        0|          10|                1|        4|          -1|             3|         0|                  -1|
|  6211|        0|           9|                1|        3|          -1|             3|         0|                   2|
|  9293|        0|           5|                2|        5|          -1|             3|         0|                   4|
| 10812|        0|           4|                2|        4|          -1|             2|         0|                  -1|
| 10996|        0|           5|                2|        5|          -1|             3|         0|                   4|
| 11602|        0|           5|                2|        5|          -1|             3|         0|                   2|
| 11727|        0|           3|                2|        3|          -1|             3|         0|                   1|
| 12195|        0|          10|                1|        4|          -1|             3|         0|                   2|
+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+
only showing top 10 rows

[1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0]
&#x9884;&#x6D4B;&#x503C;&#x603B;&#x6570; 575917
</code></pre>
<ul>
<li>&#x8F6C;&#x6362;&#x4E3A;pandas dataframe</li>
</ul>
<pre><code class="lang-python"><span class="hljs-comment"># &#x8FD9;&#x91CC;&#x6570;&#x636E;&#x91CF;&#x6BD4;&#x8F83;&#x5C0F;&#xFF0C;&#x76F4;&#x63A5;&#x8F6C;&#x6362;&#x4E3A;pandas dataframe&#x6765;&#x5904;&#x7406;&#xFF0C;&#x56E0;&#x4E3A;&#x65B9;&#x4FBF;&#xFF0C;&#x4F46;&#x6CE8;&#x610F;&#x5982;&#x679C;&#x6570;&#x636E;&#x91CF;&#x8F83;&#x5927;&#x4E0D;&#x63A8;&#x8350;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x6837;&#x4F1A;&#x628A;&#x5168;&#x90E8;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#x4E2D;</span>
temp = predicts.map(<span class="hljs-keyword">lambda</span> x:int(x)).collect()
pdf = pl_na_df.toPandas()
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
 <span class="hljs-comment"># &#x5728;pandas df&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x76F4;&#x63A5;&#x66FF;&#x6362;&#x6389;&#x5217;&#x6570;&#x636E;</span>
pdf[<span class="hljs-string">&quot;pvalue_level&quot;</span>] = np.array(temp) + <span class="hljs-number">1</span>  <span class="hljs-comment"># &#x6CE8;&#x610F;+1 &#x8FD8;&#x539F;&#x9884;&#x6D4B;&#x503C;</span>
pdf
</code></pre>
<ul>
<li>&#x4E0E;&#x975E;&#x7F3A;&#x5931;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x62FC;&#x63A5;&#xFF0C;&#x5B8C;&#x6210;pvalue_level&#x7684;&#x7F3A;&#x5931;&#x503C;&#x9884;&#x6D4B;</li>
</ul>
<pre><code class="lang-python">new_user_profile_df = user_profile_df.dropna(subset=[<span class="hljs-string">&quot;pvalue_level&quot;</span>]).unionAll(spark.createDataFrame(pdf, schema=schema))
new_user_profile_df.show()

<span class="hljs-comment"># &#x6CE8;&#x610F;&#xFF1A;unionAll&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x4E24;&#x4E2A;df&#x7684;&#x8868;&#x7ED3;&#x6784;&#x5FC5;&#x987B;&#x5B8C;&#x5168;&#x4E00;&#x6837;</span>
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code class="lang-shell">+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+
|userId|cms_segid|cms_group_id|final_gender_code|age_level|pvalue_level|shopping_level|occupation|new_user_class_level|
+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+
|   523|        5|           2|                2|        2|           1|             3|         1|                   2|
|   612|        0|           8|                1|        2|           2|             3|         0|                null|
|  3644|       49|           6|                2|        6|           2|             3|         0|                   2|
|  5777|       44|           5|                2|        5|           2|             3|         0|                   2|
|  6355|        2|           1|                2|        1|           1|             3|         0|                   4|
|  6823|       43|           5|                2|        5|           2|             3|         0|                   1|
|  6972|        5|           2|                2|        2|           2|             3|         1|                   2|
|  9510|       55|           8|                1|        2|           2|             2|         0|                   2|
| 10122|       33|           4|                2|        4|           2|             3|         0|                   2|
| 10549|        0|           4|                2|        4|           2|             3|         0|                null|
| 10912|        0|           4|                2|        4|           2|             3|         0|                null|
| 11256|        8|           2|                2|        2|           1|             3|         0|                   3|
| 11310|       31|           4|                2|        4|           1|             3|         0|                   4|
| 11739|       20|           3|                2|        3|           2|             3|         0|                   4|
| 12549|       33|           4|                2|        4|           2|             3|         0|                   2|
| 15155|       36|           5|                2|        5|           2|             1|         0|                null|
| 15347|       20|           3|                2|        3|           2|             3|         0|                   3|
| 15455|        8|           2|                2|        2|           2|             3|         0|                   3|
| 15783|        0|           4|                2|        4|           2|             3|         0|                null|
| 16749|        5|           2|                2|        2|           1|             3|         1|                   4|
+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+
only showing top 20 rows
</code></pre>
<ul>
<li>&#x5229;&#x7528;&#x968F;&#x673A;&#x68EE;&#x6797;&#x5BF9;new_user_class_level&#x7684;&#x7F3A;&#x5931;&#x503C;&#x8FDB;&#x884C;&#x9884;&#x6D4B;</li>
</ul>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> pyspark.mllib.regression <span class="hljs-keyword">import</span> LabeledPoint

<span class="hljs-comment"># &#x9009;&#x51FA;new_user_class_level&#x5168;&#x90E8;&#x7684;</span>
train_data2 = user_profile_df.dropna(subset=[<span class="hljs-string">&quot;new_user_class_level&quot;</span>]).rdd.map(
    <span class="hljs-keyword">lambda</span> r:LabeledPoint(r.new_user_class_level - <span class="hljs-number">1</span>, [r.cms_segid, r.cms_group_id, r.final_gender_code, r.age_level, r.shopping_level, r.occupation])
)
<span class="hljs-keyword">from</span> pyspark.mllib.tree <span class="hljs-keyword">import</span> RandomForest
model2 = RandomForest.trainClassifier(train_data2, <span class="hljs-number">4</span>, {}, <span class="hljs-number">5</span>)
model2.predict([<span class="hljs-number">0.0</span>, <span class="hljs-number">4.0</span> ,<span class="hljs-number">2.0</span> , <span class="hljs-number">4.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>])
<span class="hljs-comment"># &#x9884;&#x6D4B;&#x503C;&#x5B9E;&#x9645;&#x5E94;&#x8BE5;&#x4E3A;2</span>
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code class="lang-shell">1.0
</code></pre>
<pre><code class="lang-python">nul_na_df = user_profile_df.na.fill(<span class="hljs-number">-1</span>).where(<span class="hljs-string">&quot;new_user_class_level=-1&quot;</span>)
nul_na_df.show(<span class="hljs-number">10</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">row</span><span class="hljs-params">(r)</span>:</span>
    <span class="hljs-keyword">return</span> r.cms_segid, r.cms_group_id, r.final_gender_code, r.age_level, r.shopping_level, r.occupation

rdd2 = nul_na_df.rdd.map(row)
predicts2 = model.predict(rdd2)
predicts2.take(<span class="hljs-number">20</span>)
</code></pre>
<ul>
<li>&#x663E;&#x793A;&#x7ED3;&#x679C;:</li>
</ul>
<pre><code>+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+
|userId|cms_segid|cms_group_id|final_gender_code|age_level|pvalue_level|shopping_level|occupation|new_user_class_level|
+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+
|   612|        0|           8|                1|        2|           2|             3|         0|                  -1|
|  1670|        0|           4|                2|        4|          -1|             1|         0|                  -1|
|  2545|        0|          10|                1|        4|          -1|             3|         0|                  -1|
| 10549|        0|           4|                2|        4|           2|             3|         0|                  -1|
| 10812|        0|           4|                2|        4|          -1|             2|         0|                  -1|
| 10912|        0|           4|                2|        4|           2|             3|         0|                  -1|
| 12620|        0|           4|                2|        4|          -1|             2|         0|                  -1|
| 14437|        0|           5|                2|        5|          -1|             3|         0|                  -1|
| 14574|        0|           1|                2|        1|          -1|             2|         0|                  -1|
| 14985|        0|          11|                1|        5|          -1|             2|         0|                  -1|
+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+
only showing top 10 rows

[1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 0.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 1.0,
 0.0,
 1.0,
 0.0,
 0.0,
 1.0]
</code></pre><ul>
<li>&#x603B;&#x7ED3;&#xFF1A;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x7531;&#x4E8E;&#x8FD9;&#x4E24;&#x4E2A;&#x5B57;&#x6BB5;&#x7684;&#x7F3A;&#x5931;&#x8FC7;&#x591A;&#xFF0C;&#x6240;&#x4EE5;&#x9884;&#x6D4B;&#x51FA;&#x6765;&#x7684;&#x503C;&#x5DF2;&#x7ECF;&#x5927;&#x5927;&#x5931;&#x771F;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x7F3A;&#x5931;&#x7387;&#x5728;10%&#x4EE5;&#x4E0B;&#xFF0C;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x662F;&#x6BD4;&#x8F83;&#x6709;&#x6548;&#x7684;&#x4E00;&#x79CD;</li>
</ul>
<pre><code class="lang-python">user_profile_df = user_profile_df.na.fill(<span class="hljs-number">-1</span>)
user_profile_df.show()
<span class="hljs-comment"># new_df = new_df.withColumn(&quot;pvalue_level&quot;, new_df.pvalue_level.cast(StringType()))\</span>
<span class="hljs-comment">#     .withColumn(&quot;new_user_class_level&quot;, new_df.new_user_class_level.cast(StringType()))</span>
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code class="lang-shell">+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+
|userId|cms_segid|cms_group_id|final_gender_code|age_level|pvalue_level|shopping_level|occupation|new_user_class_level|
+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+
|   234|        0|           5|                2|        5|          -1|             3|         0|                   3|
|   523|        5|           2|                2|        2|           1|             3|         1|                   2|
|   612|        0|           8|                1|        2|           2|             3|         0|                  -1|
|  1670|        0|           4|                2|        4|          -1|             1|         0|                  -1|
|  2545|        0|          10|                1|        4|          -1|             3|         0|                  -1|
|  3644|       49|           6|                2|        6|           2|             3|         0|                   2|
|  5777|       44|           5|                2|        5|           2|             3|         0|                   2|
|  6211|        0|           9|                1|        3|          -1|             3|         0|                   2|
|  6355|        2|           1|                2|        1|           1|             3|         0|                   4|
|  6823|       43|           5|                2|        5|           2|             3|         0|                   1|
|  6972|        5|           2|                2|        2|           2|             3|         1|                   2|
|  9293|        0|           5|                2|        5|          -1|             3|         0|                   4|
|  9510|       55|           8|                1|        2|           2|             2|         0|                   2|
| 10122|       33|           4|                2|        4|           2|             3|         0|                   2|
| 10549|        0|           4|                2|        4|           2|             3|         0|                  -1|
| 10812|        0|           4|                2|        4|          -1|             2|         0|                  -1|
| 10912|        0|           4|                2|        4|           2|             3|         0|                  -1|
| 10996|        0|           5|                2|        5|          -1|             3|         0|                   4|
| 11256|        8|           2|                2|        2|           1|             3|         0|                   3|
| 11310|       31|           4|                2|        4|           1|             3|         0|                   4|
+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+
only showing top 20 rows
</code></pre>
<ul>
<li>&#x4F4E;&#x7EF4;&#x8F6C;&#x9AD8;&#x7EF4;&#x65B9;&#x5F0F;<ul>
<li>&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x6765;&#x91C7;&#x7528;&#x5C06;&#x53D8;&#x91CF;&#x6620;&#x5C04;&#x5230;&#x9AD8;&#x7EF4;&#x7A7A;&#x95F4;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x5904;&#x7406;&#x6570;&#x636E;&#xFF0C;&#x5373;&#x5C06;&#x7F3A;&#x5931;&#x9879;&#x4E5F;&#x5F53;&#x505A;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x7279;&#x5F81;&#x6765;&#x5BF9;&#x5F85;&#xFF0C;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x7684;&#x539F;&#x59CB;&#x6027;
&#x7531;&#x4E8E;&#x8BE5;&#x601D;&#x60F3;&#x6B63;&#x597D;&#x548C;&#x70ED;&#x72EC;&#x7F16;&#x7801;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#x4E00;&#x6837;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x91CC;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x70ED;&#x72EC;&#x7F16;&#x7801;&#x65B9;&#x5F0F;&#x5904;&#x7406;&#x6570;&#x636E;</li>
</ul>
</li>
</ul>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> pyspark.ml.feature <span class="hljs-keyword">import</span> OneHotEncoder
<span class="hljs-keyword">from</span> pyspark.ml.feature <span class="hljs-keyword">import</span> StringIndexer
<span class="hljs-keyword">from</span> pyspark.ml <span class="hljs-keyword">import</span> Pipeline

<span class="hljs-comment"># &#x4F7F;&#x7528;&#x70ED;&#x72EC;&#x7F16;&#x7801;&#x8F6C;&#x6362;pvalue_level&#x7684;&#x4E00;&#x7EF4;&#x6570;&#x636E;&#x4E3A;&#x591A;&#x7EF4;&#xFF0C;&#x5176;&#x4E2D;&#x7F3A;&#x5931;&#x503C;&#x5355;&#x72EC;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x7279;&#x5F81;&#x503C;</span>

<span class="hljs-comment"># &#x9700;&#x8981;&#x5148;&#x5C06;&#x7F3A;&#x5931;&#x503C;&#x5168;&#x90E8;&#x66FF;&#x6362;&#x4E3A;&#x6570;&#x503C;&#xFF0C;&#x4E0E;&#x539F;&#x6709;&#x7279;&#x5F81;&#x4E00;&#x8D77;&#x5904;&#x7406;</span>
<span class="hljs-keyword">from</span> pyspark.sql.types <span class="hljs-keyword">import</span> StringType
user_profile_df = user_profile_df.na.fill(<span class="hljs-number">-1</span>)
user_profile_df.show()

<span class="hljs-comment"># &#x70ED;&#x72EC;&#x7F16;&#x7801;&#x65F6;&#xFF0C;&#x5FC5;&#x987B;&#x5148;&#x5C06;&#x5F85;&#x5904;&#x7406;&#x5B57;&#x6BB5;&#x8F6C;&#x4E3A;&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;&#x624D;&#x53EF;&#x5904;&#x7406;</span>
user_profile_df = user_profile_df.withColumn(<span class="hljs-string">&quot;pvalue_level&quot;</span>, user_profile_df.pvalue_level.cast(StringType()))\
    .withColumn(<span class="hljs-string">&quot;new_user_class_level&quot;</span>, user_profile_df.new_user_class_level.cast(StringType()))
user_profile_df.printSchema()

<span class="hljs-comment"># &#x5BF9;pvalue_level&#x8FDB;&#x884C;&#x70ED;&#x72EC;&#x7F16;&#x7801;&#xFF0C;&#x6C42;&#x503C;</span>
stringindexer = StringIndexer(inputCol=<span class="hljs-string">&apos;pvalue_level&apos;</span>, outputCol=<span class="hljs-string">&apos;pl_onehot_feature&apos;</span>)
encoder = OneHotEncoder(dropLast=<span class="hljs-keyword">False</span>, inputCol=<span class="hljs-string">&apos;pl_onehot_feature&apos;</span>, outputCol=<span class="hljs-string">&apos;pl_onehot_value&apos;</span>)
pipeline = Pipeline(stages=[stringindexer, encoder])
pipeline_fit = pipeline.fit(user_profile_df)
user_profile_df2 = pipeline_fit.transform(user_profile_df)
<span class="hljs-comment"># pl_onehot_value&#x5217;&#x7684;&#x503C;&#x4E3A;&#x7A00;&#x758F;&#x5411;&#x91CF;&#xFF0C;&#x5B58;&#x50A8;&#x70ED;&#x72EC;&#x7F16;&#x7801;&#x7684;&#x7ED3;&#x679C;</span>
user_profile_df2.printSchema()
user_profile_df2.show()
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code class="lang-shell">+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+
|userId|cms_segid|cms_group_id|final_gender_code|age_level|pvalue_level|shopping_level|occupation|new_user_class_level|
+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+
|   234|        0|           5|                2|        5|          -1|             3|         0|                   3|
|   523|        5|           2|                2|        2|           1|             3|         1|                   2|
|   612|        0|           8|                1|        2|           2|             3|         0|                  -1|
|  1670|        0|           4|                2|        4|          -1|             1|         0|                  -1|
|  2545|        0|          10|                1|        4|          -1|             3|         0|                  -1|
|  3644|       49|           6|                2|        6|           2|             3|         0|                   2|
|  5777|       44|           5|                2|        5|           2|             3|         0|                   2|
|  6211|        0|           9|                1|        3|          -1|             3|         0|                   2|
|  6355|        2|           1|                2|        1|           1|             3|         0|                   4|
|  6823|       43|           5|                2|        5|           2|             3|         0|                   1|
|  6972|        5|           2|                2|        2|           2|             3|         1|                   2|
|  9293|        0|           5|                2|        5|          -1|             3|         0|                   4|
|  9510|       55|           8|                1|        2|           2|             2|         0|                   2|
| 10122|       33|           4|                2|        4|           2|             3|         0|                   2|
| 10549|        0|           4|                2|        4|           2|             3|         0|                  -1|
| 10812|        0|           4|                2|        4|          -1|             2|         0|                  -1|
| 10912|        0|           4|                2|        4|           2|             3|         0|                  -1|
| 10996|        0|           5|                2|        5|          -1|             3|         0|                   4|
| 11256|        8|           2|                2|        2|           1|             3|         0|                   3|
| 11310|       31|           4|                2|        4|           1|             3|         0|                   4|
+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+
only showing top 20 rows

root
 |-- userId: integer (nullable = true)
 |-- cms_segid: integer (nullable = true)
 |-- cms_group_id: integer (nullable = true)
 |-- final_gender_code: integer (nullable = true)
 |-- age_level: integer (nullable = true)
 |-- pvalue_level: string (nullable = true)
 |-- shopping_level: integer (nullable = true)
 |-- occupation: integer (nullable = true)
 |-- new_user_class_level: string (nullable = true)

root
 |-- userId: integer (nullable = true)
 |-- cms_segid: integer (nullable = true)
 |-- cms_group_id: integer (nullable = true)
 |-- final_gender_code: integer (nullable = true)
 |-- age_level: integer (nullable = true)
 |-- pvalue_level: string (nullable = true)
 |-- shopping_level: integer (nullable = true)
 |-- occupation: integer (nullable = true)
 |-- new_user_class_level: string (nullable = true)
 |-- pl_onehot_feature: double (nullable = false)
 |-- pl_onehot_value: vector (nullable = true)

+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+-----------------+---------------+
|userId|cms_segid|cms_group_id|final_gender_code|age_level|pvalue_level|shopping_level|occupation|new_user_class_level|pl_onehot_feature|pl_onehot_value|
+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+-----------------+---------------+
|   234|        0|           5|                2|        5|          -1|             3|         0|                   3|              0.0|  (4,[0],[1.0])|
|   523|        5|           2|                2|        2|           1|             3|         1|                   2|              2.0|  (4,[2],[1.0])|
|   612|        0|           8|                1|        2|           2|             3|         0|                  -1|              1.0|  (4,[1],[1.0])|
|  1670|        0|           4|                2|        4|          -1|             1|         0|                  -1|              0.0|  (4,[0],[1.0])|
|  2545|        0|          10|                1|        4|          -1|             3|         0|                  -1|              0.0|  (4,[0],[1.0])|
|  3644|       49|           6|                2|        6|           2|             3|         0|                   2|              1.0|  (4,[1],[1.0])|
|  5777|       44|           5|                2|        5|           2|             3|         0|                   2|              1.0|  (4,[1],[1.0])|
|  6211|        0|           9|                1|        3|          -1|             3|         0|                   2|              0.0|  (4,[0],[1.0])|
|  6355|        2|           1|                2|        1|           1|             3|         0|                   4|              2.0|  (4,[2],[1.0])|
|  6823|       43|           5|                2|        5|           2|             3|         0|                   1|              1.0|  (4,[1],[1.0])|
|  6972|        5|           2|                2|        2|           2|             3|         1|                   2|              1.0|  (4,[1],[1.0])|
|  9293|        0|           5|                2|        5|          -1|             3|         0|                   4|              0.0|  (4,[0],[1.0])|
|  9510|       55|           8|                1|        2|           2|             2|         0|                   2|              1.0|  (4,[1],[1.0])|
| 10122|       33|           4|                2|        4|           2|             3|         0|                   2|              1.0|  (4,[1],[1.0])|
| 10549|        0|           4|                2|        4|           2|             3|         0|                  -1|              1.0|  (4,[1],[1.0])|
| 10812|        0|           4|                2|        4|          -1|             2|         0|                  -1|              0.0|  (4,[0],[1.0])|
| 10912|        0|           4|                2|        4|           2|             3|         0|                  -1|              1.0|  (4,[1],[1.0])|
| 10996|        0|           5|                2|        5|          -1|             3|         0|                   4|              0.0|  (4,[0],[1.0])|
| 11256|        8|           2|                2|        2|           1|             3|         0|                   3|              2.0|  (4,[2],[1.0])|
| 11310|       31|           4|                2|        4|           1|             3|         0|                   4|              2.0|  (4,[2],[1.0])|
+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+-----------------+---------------+
only showing top 20 rows
</code></pre>
<ul>
<li>&#x4F7F;&#x7528;&#x70ED;&#x7F16;&#x7801;&#x8F6C;&#x6362;new_user_class_level&#x7684;&#x4E00;&#x7EF4;&#x6570;&#x636E;&#x4E3A;&#x591A;&#x7EF4;</li>
</ul>
<pre><code class="lang-python">stringindexer = StringIndexer(inputCol=<span class="hljs-string">&apos;new_user_class_level&apos;</span>, outputCol=<span class="hljs-string">&apos;nucl_onehot_feature&apos;</span>)
encoder = OneHotEncoder(dropLast=<span class="hljs-keyword">False</span>, inputCol=<span class="hljs-string">&apos;nucl_onehot_feature&apos;</span>, outputCol=<span class="hljs-string">&apos;nucl_onehot_value&apos;</span>)
pipeline = Pipeline(stages=[stringindexer, encoder])
pipeline_fit = pipeline.fit(user_profile_df2)
user_profile_df3 = pipeline_fit.transform(user_profile_df2)
user_profile_df3.show()
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code class="lang-shell">+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+-----------------+---------------+-------------------+-----------------+
|userId|cms_segid|cms_group_id|final_gender_code|age_level|pvalue_level|shopping_level|occupation|new_user_class_level|pl_onehot_feature|pl_onehot_value|nucl_onehot_feature|nucl_onehot_value|
+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+-----------------+---------------+-------------------+-----------------+
|   234|        0|           5|                2|        5|          -1|             3|         0|                   3|              0.0|  (4,[0],[1.0])|                2.0|    (5,[2],[1.0])|
|   523|        5|           2|                2|        2|           1|             3|         1|                   2|              2.0|  (4,[2],[1.0])|                1.0|    (5,[1],[1.0])|
|   612|        0|           8|                1|        2|           2|             3|         0|                  -1|              1.0|  (4,[1],[1.0])|                0.0|    (5,[0],[1.0])|
|  1670|        0|           4|                2|        4|          -1|             1|         0|                  -1|              0.0|  (4,[0],[1.0])|                0.0|    (5,[0],[1.0])|
|  2545|        0|          10|                1|        4|          -1|             3|         0|                  -1|              0.0|  (4,[0],[1.0])|                0.0|    (5,[0],[1.0])|
|  3644|       49|           6|                2|        6|           2|             3|         0|                   2|              1.0|  (4,[1],[1.0])|                1.0|    (5,[1],[1.0])|
|  5777|       44|           5|                2|        5|           2|             3|         0|                   2|              1.0|  (4,[1],[1.0])|                1.0|    (5,[1],[1.0])|
|  6211|        0|           9|                1|        3|          -1|             3|         0|                   2|              0.0|  (4,[0],[1.0])|                1.0|    (5,[1],[1.0])|
|  6355|        2|           1|                2|        1|           1|             3|         0|                   4|              2.0|  (4,[2],[1.0])|                3.0|    (5,[3],[1.0])|
|  6823|       43|           5|                2|        5|           2|             3|         0|                   1|              1.0|  (4,[1],[1.0])|                4.0|    (5,[4],[1.0])|
|  6972|        5|           2|                2|        2|           2|             3|         1|                   2|              1.0|  (4,[1],[1.0])|                1.0|    (5,[1],[1.0])|
|  9293|        0|           5|                2|        5|          -1|             3|         0|                   4|              0.0|  (4,[0],[1.0])|                3.0|    (5,[3],[1.0])|
|  9510|       55|           8|                1|        2|           2|             2|         0|                   2|              1.0|  (4,[1],[1.0])|                1.0|    (5,[1],[1.0])|
| 10122|       33|           4|                2|        4|           2|             3|         0|                   2|              1.0|  (4,[1],[1.0])|                1.0|    (5,[1],[1.0])|
| 10549|        0|           4|                2|        4|           2|             3|         0|                  -1|              1.0|  (4,[1],[1.0])|                0.0|    (5,[0],[1.0])|
| 10812|        0|           4|                2|        4|          -1|             2|         0|                  -1|              0.0|  (4,[0],[1.0])|                0.0|    (5,[0],[1.0])|
| 10912|        0|           4|                2|        4|           2|             3|         0|                  -1|              1.0|  (4,[1],[1.0])|                0.0|    (5,[0],[1.0])|
| 10996|        0|           5|                2|        5|          -1|             3|         0|                   4|              0.0|  (4,[0],[1.0])|                3.0|    (5,[3],[1.0])|
| 11256|        8|           2|                2|        2|           1|             3|         0|                   3|              2.0|  (4,[2],[1.0])|                2.0|    (5,[2],[1.0])|
| 11310|       31|           4|                2|        4|           1|             3|         0|                   4|              2.0|  (4,[2],[1.0])|                3.0|    (5,[3],[1.0])|
+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+-----------------+---------------+-------------------+-----------------+
only showing top 20 rows
</code></pre>
<ul>
<li>&#x7528;&#x6237;&#x7279;&#x5F81;&#x5408;&#x5E76;</li>
</ul>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> pyspark.ml.feature <span class="hljs-keyword">import</span> VectorAssembler
feature_df = VectorAssembler().setInputCols([<span class="hljs-string">&quot;age_level&quot;</span>, <span class="hljs-string">&quot;pl_onehot_value&quot;</span>, <span class="hljs-string">&quot;nucl_onehot_value&quot;</span>]).setOutputCol(<span class="hljs-string">&quot;features&quot;</span>).transform(user_profile_df3)
feature_df.show()
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code class="lang-shell">+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+-----------------+---------------+-------------------+-----------------+--------------------+
|userId|cms_segid|cms_group_id|final_gender_code|age_level|pvalue_level|shopping_level|occupation|new_user_class_level|pl_onehot_feature|pl_onehot_value|nucl_onehot_feature|nucl_onehot_value|            features|
+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+-----------------+---------------+-------------------+-----------------+--------------------+
|   234|        0|           5|                2|        5|          -1|             3|         0|                   3|              0.0|  (4,[0],[1.0])|                2.0|    (5,[2],[1.0])|(10,[0,1,7],[5.0,...|
|   523|        5|           2|                2|        2|           1|             3|         1|                   2|              2.0|  (4,[2],[1.0])|                1.0|    (5,[1],[1.0])|(10,[0,3,6],[2.0,...|
|   612|        0|           8|                1|        2|           2|             3|         0|                  -1|              1.0|  (4,[1],[1.0])|                0.0|    (5,[0],[1.0])|(10,[0,2,5],[2.0,...|
|  1670|        0|           4|                2|        4|          -1|             1|         0|                  -1|              0.0|  (4,[0],[1.0])|                0.0|    (5,[0],[1.0])|(10,[0,1,5],[4.0,...|
|  2545|        0|          10|                1|        4|          -1|             3|         0|                  -1|              0.0|  (4,[0],[1.0])|                0.0|    (5,[0],[1.0])|(10,[0,1,5],[4.0,...|
|  3644|       49|           6|                2|        6|           2|             3|         0|                   2|              1.0|  (4,[1],[1.0])|                1.0|    (5,[1],[1.0])|(10,[0,2,6],[6.0,...|
|  5777|       44|           5|                2|        5|           2|             3|         0|                   2|              1.0|  (4,[1],[1.0])|                1.0|    (5,[1],[1.0])|(10,[0,2,6],[5.0,...|
|  6211|        0|           9|                1|        3|          -1|             3|         0|                   2|              0.0|  (4,[0],[1.0])|                1.0|    (5,[1],[1.0])|(10,[0,1,6],[3.0,...|
|  6355|        2|           1|                2|        1|           1|             3|         0|                   4|              2.0|  (4,[2],[1.0])|                3.0|    (5,[3],[1.0])|(10,[0,3,8],[1.0,...|
|  6823|       43|           5|                2|        5|           2|             3|         0|                   1|              1.0|  (4,[1],[1.0])|                4.0|    (5,[4],[1.0])|(10,[0,2,9],[5.0,...|
|  6972|        5|           2|                2|        2|           2|             3|         1|                   2|              1.0|  (4,[1],[1.0])|                1.0|    (5,[1],[1.0])|(10,[0,2,6],[2.0,...|
|  9293|        0|           5|                2|        5|          -1|             3|         0|                   4|              0.0|  (4,[0],[1.0])|                3.0|    (5,[3],[1.0])|(10,[0,1,8],[5.0,...|
|  9510|       55|           8|                1|        2|           2|             2|         0|                   2|              1.0|  (4,[1],[1.0])|                1.0|    (5,[1],[1.0])|(10,[0,2,6],[2.0,...|
| 10122|       33|           4|                2|        4|           2|             3|         0|                   2|              1.0|  (4,[1],[1.0])|                1.0|    (5,[1],[1.0])|(10,[0,2,6],[4.0,...|
| 10549|        0|           4|                2|        4|           2|             3|         0|                  -1|              1.0|  (4,[1],[1.0])|                0.0|    (5,[0],[1.0])|(10,[0,2,5],[4.0,...|
| 10812|        0|           4|                2|        4|          -1|             2|         0|                  -1|              0.0|  (4,[0],[1.0])|                0.0|    (5,[0],[1.0])|(10,[0,1,5],[4.0,...|
| 10912|        0|           4|                2|        4|           2|             3|         0|                  -1|              1.0|  (4,[1],[1.0])|                0.0|    (5,[0],[1.0])|(10,[0,2,5],[4.0,...|
| 10996|        0|           5|                2|        5|          -1|             3|         0|                   4|              0.0|  (4,[0],[1.0])|                3.0|    (5,[3],[1.0])|(10,[0,1,8],[5.0,...|
| 11256|        8|           2|                2|        2|           1|             3|         0|                   3|              2.0|  (4,[2],[1.0])|                2.0|    (5,[2],[1.0])|(10,[0,3,7],[2.0,...|
| 11310|       31|           4|                2|        4|           1|             3|         0|                   4|              2.0|  (4,[2],[1.0])|                3.0|    (5,[3],[1.0])|(10,[0,3,8],[4.0,...|
+------+---------+------------+-----------------+---------+------------+--------------+----------+--------------------+-----------------+---------------+-------------------+-----------------+--------------------+
only showing top 20 rows
</code></pre>
<pre><code class="lang-python">feature_df.select(<span class="hljs-string">&quot;features&quot;</span>).show()
</code></pre>
<p>&#x663E;&#x793A;&#x7ED3;&#x679C;:</p>
<pre><code class="lang-shell">+--------------------+
|            features|
+--------------------+
|(10,[0,1,7],[5.0,...|
|(10,[0,3,6],[2.0,...|
|(10,[0,2,5],[2.0,...|
|(10,[0,1,5],[4.0,...|
|(10,[0,1,5],[4.0,...|
|(10,[0,2,6],[6.0,...|
|(10,[0,2,6],[5.0,...|
|(10,[0,1,6],[3.0,...|
|(10,[0,3,8],[1.0,...|
|(10,[0,2,9],[5.0,...|
|(10,[0,2,6],[2.0,...|
|(10,[0,1,8],[5.0,...|
|(10,[0,2,6],[2.0,...|
|(10,[0,2,6],[4.0,...|
|(10,[0,2,5],[4.0,...|
|(10,[0,1,5],[4.0,...|
|(10,[0,2,5],[4.0,...|
|(10,[0,1,8],[5.0,...|
|(10,[0,3,7],[2.0,...|
|(10,[0,3,8],[4.0,...|
+--------------------+
only showing top 20 rows
</code></pre>
<ul>
<li>&#x7279;&#x5F81;&#x9009;&#x53D6;</li>
</ul>
<p>&#x9664;&#x4E86;&#x524D;&#x9762;&#x5904;&#x7406;&#x7684;pvalue_level&#x548C;new_user_class_level&#x9700;&#x8981;&#x4F5C;&#x4E3A;&#x7279;&#x5F81;&#x4EE5;&#x5916;&#xFF0C;(&#x80FD;&#x4F53;&#x73B0;&#x51FA;&#x7528;&#x6237;&#x7684;&#x8D2D;&#x4E70;&#x529B;&#x7279;&#x5F81;)&#xFF0C;&#x8FD8;&#x6709;&#xFF1A;</p>
<p>&#x524D;&#x9762;&#x5206;&#x6790;&#x7684;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x5206;&#x7C7B;&#x7279;&#x5F81;&#x503C;&#x4E2A;&#x6570;&#x60C5;&#x51B5;:</p>
<pre><code>- cms_segid:  97
- cms_group_id:  13
- final_gender_code:  2
- age_level:  7
- shopping_level:  3
- occupation:  2
</code></pre><p>&#x6839;&#x636E;&#x7ECF;&#x9A8C;&#xFF0C;&#x4EE5;&#x4E0A;&#x51E0;&#x4E2A;&#x5206;&#x7C7B;&#x7279;&#x5F81;&#x90FD;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x80FD;&#x4F53;&#x73B0;&#x7528;&#x6237;&#x5728;&#x8D2D;&#x7269;&#x65B9;&#x9762;&#x7684;&#x7279;&#x5F81;&#xFF0C;&#x4E14;&#x7C7B;&#x522B;&#x90FD;&#x8F83;&#x5C11;&#xFF0C;&#x90FD;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x4F5C;&#x4E3A;&#x7528;&#x6237;&#x7279;&#x5F81;</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="02_根据用户行为数据创建ALS模型并召回商品.html" class="navigation navigation-prev " aria-label="Previous page: 商品召回">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="04_逻辑回归实现CTR预估.html" class="navigation navigation-next " aria-label="Next page: 逻辑回归实现CTR预估">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"CTR预估数据准备","level":"1.6.3","depth":2,"next":{"title":"逻辑回归实现CTR预估","level":"1.6.4","depth":2,"path":"推荐系统实战1/04_逻辑回归实现CTR预估.md","ref":"推荐系统实战1/04_逻辑回归实现CTR预估.md","articles":[]},"previous":{"title":"商品召回","level":"1.6.2","depth":2,"path":"推荐系统实战1/02_根据用户行为数据创建ALS模型并召回商品.md","ref":"推荐系统实战1/02_根据用户行为数据创建ALS模型并召回商品.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"推荐系统实战1/03_CTR预估数据准备.md","mtime":"2019-03-14T15:32:44.422Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-04-24T13:41:26.681Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

